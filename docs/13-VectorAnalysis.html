<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.510">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Визуализация и анализ географических данных на языке R - 13&nbsp; Векторный анализ</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./14-RasterAnalysis.html" rel="next">
<link href="./12-3DModels.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./13-VectorAnalysis.html">Пространственный анализ</a></li><li class="breadcrumb-item"><a href="./13-VectorAnalysis.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Векторный анализ</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Визуализация и анализ географических данных на языке R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Введение</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Основы</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-Basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Типы данных</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-DataStructures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Структуры данных</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-Tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Таблицы</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-Functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Функции</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Графика и статистика</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-BaseGraphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Базовая графика</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-AdvGraphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Продвинутая графика</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-BaseStats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Основы статистики</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-AdvStats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Временные ряды</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Пространственные данные и карты</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-SpatialData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Пространственные данные</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Основы картографии</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-ThematicMaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Тематические карты</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-3DModels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Трехмерные модели</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Пространственный анализ</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-VectorAnalysis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Векторный анализ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-RasterAnalysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Растровый анализ</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-Interpolation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Интерполяция геополей</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Библиография</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#mapping3d_prerequisites" id="toc-mapping3d_prerequisites" class="nav-link active" data-scroll-target="#mapping3d_prerequisites"><span class="header-section-number">13.1</span> Предварительные условия</a></li>
  <li><a href="#spatial_queries" id="toc-spatial_queries" class="nav-link" data-scroll-target="#spatial_queries"><span class="header-section-number">13.2</span> Пространственные запросы</a>
  <ul class="collapse">
  <li><a href="#context_objects" id="toc-context_objects" class="nav-link" data-scroll-target="#context_objects"><span class="header-section-number">13.2.1</span> Контекстные и целевые объекты</a></li>
  <li><a href="#sf_spat_metric" id="toc-sf_spat_metric" class="nav-link" data-scroll-target="#sf_spat_metric"><span class="header-section-number">13.2.2</span> Метрические отношение</a></li>
  <li><a href="#sf_spat_topology" id="toc-sf_spat_topology" class="nav-link" data-scroll-target="#sf_spat_topology"><span class="header-section-number">13.2.3</span> Топологические отношения</a></li>
  <li><a href="#zones" id="toc-zones" class="nav-link" data-scroll-target="#zones"><span class="header-section-number">13.2.4</span> Зоны окружения объектов</a></li>
  </ul></li>
  <li><a href="#use_case" id="toc-use_case" class="nav-link" data-scroll-target="#use_case"><span class="header-section-number">13.3</span> Постановка задач и изучение данных</a></li>
  <li><a href="#distance_analysis" id="toc-distance_analysis" class="nav-link" data-scroll-target="#distance_analysis"><span class="header-section-number">13.4</span> Анализ расстояний</a></li>
  <li><a href="#topology_analysis" id="toc-topology_analysis" class="nav-link" data-scroll-target="#topology_analysis"><span class="header-section-number">13.5</span> Анализ взаимного положения (топологический)</a></li>
  <li><a href="#absolute_zones" id="toc-absolute_zones" class="nav-link" data-scroll-target="#absolute_zones"><span class="header-section-number">13.6</span> Анализ абсолютных зон окружения</a></li>
  <li><a href="#conc_zones" id="toc-conc_zones" class="nav-link" data-scroll-target="#conc_zones"><span class="header-section-number">13.7</span> Анализ конкурентных зон окружения</a></li>
  <li><a href="#areal_interpolation" id="toc-areal_interpolation" class="nav-link" data-scroll-target="#areal_interpolation"><span class="header-section-number">13.8</span> Интерполяция, взвешенная на площадь</a></li>
  <li><a href="#дирекционные-отношения" id="toc-дирекционные-отношения" class="nav-link" data-scroll-target="#дирекционные-отношения"><span class="header-section-number">13.9</span> Дирекционные отношения</a>
  <ul class="collapse">
  <li><a href="#circular_circ" id="toc-circular_circ" class="nav-link" data-scroll-target="#circular_circ"><span class="header-section-number">13.9.1</span> Статистика направлений</a></li>
  <li><a href="#circular_circ_vis" id="toc-circular_circ_vis" class="nav-link" data-scroll-target="#circular_circ_vis"><span class="header-section-number">13.9.2</span> Практика</a></li>
  </ul></li>
  <li><a href="#vector_review" id="toc-vector_review" class="nav-link" data-scroll-target="#vector_review"><span class="header-section-number">13.10</span> Краткий обзор</a></li>
  <li><a href="#qtasks_vector_analysis" id="toc-qtasks_vector_analysis" class="nav-link" data-scroll-target="#qtasks_vector_analysis"><span class="header-section-number">13.11</span> Контрольные вопросы и упражнения</a>
  <ul class="collapse">
  <li><a href="#questions_vector_analysis" id="toc-questions_vector_analysis" class="nav-link" data-scroll-target="#questions_vector_analysis"><span class="header-section-number">13.11.1</span> Вопросы</a></li>
  <li><a href="#tasks_vector_analysis" id="toc-tasks_vector_analysis" class="nav-link" data-scroll-target="#tasks_vector_analysis"><span class="header-section-number">13.11.2</span> Упражнения</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./13-VectorAnalysis.html">Пространственный анализ</a></li><li class="breadcrumb-item"><a href="./13-VectorAnalysis.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Векторный анализ</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="vector" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Векторный анализ</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="mapping3d_prerequisites" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="mapping3d_prerequisites"><span class="header-section-number">13.1</span> Предварительные условия</h2>
<p>Для выполнения кода данной лекции вам понадобятся следующие пакеты:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(classInt)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapsf) <span class="co"># Удобное построение тематических карт средствами plot()</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(circular) <span class="co"># статистика направлений</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NPCirc) <span class="co"># статистика направлений</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Данный модуль посвящен пространственному анализу в R. Несмотря на то, что пространственный анализ — чрезвычайно широкая и многогранная область геоинформатики, все методы, которые объединяются под этим заголовком, базируются на ограниченном числе базовых операций, таких как вычисление расстояний, оценка плотности распределения, построение буферных зон и выполнение пространственных запросов. В настоящем модуле мы рассмотрим, как одно и то же множество пространственных объектов можно анализировать в различных контекстах, используя базовые методы пространственного анализа</p>
<p>Пространственный анализ связан с оценкой <em>размещения</em> объектов и <em>распределения</em> величин в географическом пространстве. В геоинформатике для этих целей используется два подхода: геометрический и статистический. Эти подходы образуют две ступени пространственного анализа: как правило, данные геометрического анализа представляют собой входную информацию для анализа статистического.</p>
<p>Геометрический подход связан с вычислением расстояний между географическими локациями, а также агрегированием объектов/интегрированием показателей в пределах заданных областей, вдоль линий или в окрестности точек. Поиск входной информации для агрегирования решается путем выполнения <em>пространственных запросов</em>.</p>
</section>
<section id="spatial_queries" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="spatial_queries"><span class="header-section-number">13.2</span> Пространственные запросы</h2>
<p><strong>Пространственные запросы</strong> связаны с поиском объектов (географических локаций), удовлетворяющих условию, заданному на множестве пространственных отношений. В свою очередь, пространственные отношения бывают трех типов: <em>дирекционные</em> (направления), <em>метрические</em> (расстояния) и <em>топологические</em> (взаимное размещение). Примеры пространственных запросов знакомы любому географу:</p>
<ul>
<li>Найти все объекты внутри административного района (топологические отношения)</li>
<li>Найти все объекты не далее 100 метров от дороги (метрические отношения)</li>
<li>Найти все объекты, расположенные к северу от точки (дирекционные отношения)</li>
</ul>
<p>Пространственные запросы могут объединять несколько условий. Можно найти объекты, удовлетворяющие одновременно <em>всем</em> (<em>логическое И</em>) вышеперечисленным условиям: внутри района, не далее 100 м от дороги и к северу от выбранной точки; или <em>хотя бы одному</em> (<em>логическое ИЛИ</em>) из вышеперечисленных условий. Результат выполнения такого комплексного запроса будет являться, соответственно, пересечением множеств объектов, полученных каждым из запросов, или их объединением.</p>
<p>Наконец, пространственные запросы можно объединять с <em>атрибутивными</em> и <em>временными</em>. Атрибутивные запросы связаны с поиском объектов (географических локаций), удовлетворяющих условию, заданному на множестве характеристик объектов. Временные запросы определены на множестве шкалы времени. Например, можно найти все населенные пункты населением свыше 10 000 человек (атрибутивный запрос), находящиеся в пределах выбранного административного района (пространственный запрос, основанный на топологических отношениях), время движения от которых до районного центра не превышает 90 минут (временной запрос).</p>
<section id="context_objects" class="level3" data-number="13.2.1">
<h3 data-number="13.2.1" class="anchored" data-anchor-id="context_objects"><span class="header-section-number">13.2.1</span> Контекстные и целевые объекты</h3>
<p>При выполнении пространственного анализа, в общем случае, имеются множества объектов двух типов:</p>
<ul>
<li><strong>контекстные</strong> — объекты, относительно которых будет оцениваться размещение других объектов, то есть, определяющие <em>контекст анализа</em></li>
<li><strong>целевые</strong> — объекты, размещение которых анализируется по отношению к контекстным объектам, что является <em>целью</em> анализа</li>
</ul>
<p>Эти множества, разумеется, могут совпадать. Скажем, мы можем проанализировать размещение магазинов относительно других магазинов.</p>
</section>
<section id="sf_spat_metric" class="level3" data-number="13.2.2">
<h3 data-number="13.2.2" class="anchored" data-anchor-id="sf_spat_metric"><span class="header-section-number">13.2.2</span> Метрические отношение</h3>
</section>
<section id="sf_spat_topology" class="level3" data-number="13.2.3">
<h3 data-number="13.2.3" class="anchored" data-anchor-id="sf_spat_topology"><span class="header-section-number">13.2.3</span> Топологические отношения</h3>
<p>Поиск объектов по местоположению базируется на проверке топологических отношений между объектами. Топологические отношения описывают взаимное расположение объектов. Различные варианты топологических отношений для площадных объектов представлены на следующем рисунке, где серым цветом показаны пересечения <em>внутренних областей</em> объектов <span class="math inline">\(A\)</span> и <span class="math inline">\(B\)</span>, синим цветом — пересечения <em>границ</em> объектов <span class="math inline">\(A\)</span> и <span class="math inline">\(B\)</span>:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Отношение <em>Пересекает (intersects)</em> будет истинно для любого случая когда две геометрии имеют хотя бы одну общую точку, то есть во всех случаях кроме <em>Не пересекает (disjoint)</em>. Для проверки этих, а также некоторых других отношений, в пакете <code>sf</code> существует ряд функций:</p>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 84%">
</colgroup>
<thead>
<tr class="header">
<th>Функция</th>
<th>Топологическое отношение</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>st_intersects(x, y)</code></td>
<td><code>x</code> имеет общие точки с <code>y</code></td>
</tr>
<tr class="even">
<td><code>st_disjoint(x, y)</code></td>
<td><code>x</code> не имеет общих точек с <code>y</code></td>
</tr>
<tr class="odd">
<td><code>st_touches(x, y)</code></td>
<td><code>x</code> касается <code>y</code> (граница <code>x</code> имеет общие точки с границей <code>y</code> И внутренняя область <code>x</code> не имеет имеет общих точек с внутренней областью <code>y</code>)</td>
</tr>
<tr class="even">
<td><code>st_crosses(x, y)</code></td>
<td><code>x</code> пересекает <code>y</code> (граница <code>x</code> имеет общие точки с границей <code>y</code>, при этом размерность их пересечения меньше размерности хотя бы одного из исходных объектов)</td>
</tr>
<tr class="odd">
<td><code>st_within(x, y)</code></td>
<td><code>x</code> внутри <code>y</code> (все точки <code>x</code> содержатся в <code>y</code> И внутренняя область <code>x</code> имеет общие точки с внутренней областью <code>y</code>)</td>
</tr>
<tr class="even">
<td><code>st_contains(x, y)</code></td>
<td><code>x</code> содержит <code>y</code> (все точки <code>y</code> содержатся в <code>x</code> И внутренняя область <code>y</code> имеет общие точки с внутренней областью <code>x</code>)</td>
</tr>
<tr class="odd">
<td><code>st_contains_properly(x, y)</code></td>
<td><code>x</code> содержит <code>y</code> полностью (все точки <code>y</code> содержатся в <code>x</code> И граница <code>x</code> не имеет общих точек с границей <code>y</code>)</td>
</tr>
<tr class="even">
<td><code>st_overlaps(x, y)</code></td>
<td><code>x</code> перекрывает <code>y</code> (внутренняя область <code>x</code> имеет как общие, так и не общие точки с внутренней областью <code>y</code>)</td>
</tr>
<tr class="odd">
<td><code>st_equals(x, y)</code></td>
<td><code>x</code> совпадает <code>y</code> (множества точек <code>x</code> и <code>y</code> совпадают)</td>
</tr>
<tr class="even">
<td><code>st_covers(x, y)</code></td>
<td><code>x</code> покрывает <code>y</code> (все точки <code>y</code> содержатся в <code>x</code>)</td>
</tr>
<tr class="odd">
<td><code>st_covered_by(x, y)</code></td>
<td><code>x</code> покрыт <code>y</code> (все точки <code>x</code> содержатся в <code>y</code>)</td>
</tr>
<tr class="even">
<td><code>st_equals_exact(x, y)</code></td>
<td><code>x</code> совпадает <code>y</code> точно (упорядоченные множества точек <code>x</code> и <code>y</code> совпадают)</td>
</tr>
</tbody>
</table>
<p>Между <code>covered_by</code> и <code>within</code>, а также <code>covers</code> и <code>contains</code> нет разницы в случае, когда оба объекта являются площадными. Эта разница будет сказываться если хотя бы один из объектов является линией либо точкой. В этом случае <code>within</code>, <code>contains</code> и <code>contains_properly</code> будут давать ложный результат (FALSE), поскольку ни у линий, ни у точек нет внутренней области.</p>
<p>Проверка топологических отношений используется для выполнения выборки объектов по местоположению — <em>пространственной выборки</em>. Наиболее простой способ выбрать объекты по пространственному местоположению — это использовать один слой в качестве фильтра для другого слоя. В этом случае будет по умолчанию использовано отношение <code>st_intersects()</code> (пересекает). Никаких отличий от работы с обычными таблицами нет. Например, вот так можно выбрать точки, находящиеся внутри ранее отобранных стран с максимальным ВВП:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>countries <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">'data/ne/countries.gpkg'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Reading layer `admin_0_map_units' from data source </span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="do">##   `/Users/tsamsonov/GitHub/r-geo-course/data/ne/countries.gpkg' </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   using driver `GPKG'</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Simple feature collection with 183 features and 72 fields</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Geometry type: MULTIPOLYGON</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Dimension:     XY</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Bounding box:  xmin: -180 ymin: -90 xmax: 180 ymax: 83.64513</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Geodetic CRS:  WGS 84</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>outlines <span class="ot">=</span> <span class="fu">st_geometry</span>(countries)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>cities <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">'data/ne/cities.gpkg'</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Reading layer `populated_places' from data source </span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="do">##   `/Users/tsamsonov/GitHub/r-geo-course/data/ne/cities.gpkg' </span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="do">##   using driver `GPKG'</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Simple feature collection with 243 features and 103 fields</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Geometry type: POINT</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Dimension:     XY</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Bounding box:  xmin: -175.2206 ymin: -41.29999 xmax: 179.2166 ymax: 64.15002</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Geodetic CRS:  WGS 84</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>city.pts <span class="ot">=</span> <span class="fu">st_geometry</span>(cities)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>largest <span class="ot">=</span> countries <span class="sc">|&gt;</span> </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pop_est) <span class="sc">|&gt;</span> </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(pop_est <span class="sc">&gt;</span> <span class="dv">100000000</span>)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Наносим исходную конфигурацию</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(outlines, <span class="at">lwd =</span> <span class="fl">0.5</span>)</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cities, <span class="at">col =</span> <span class="st">'black'</span>, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Отбираем точки внутри стран с максимальным ВВП</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>sel <span class="ot">=</span> cities[largest, ]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Смотрим что получилось</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(outlines, <span class="at">lwd =</span> <span class="fl">0.5</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(largest, <span class="at">col =</span> <span class="st">'gray'</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sel, <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">col =</span> <span class="st">'black'</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Разумеется, при выполнении пространственных запросов могут возникать и другие пространственные отношения. Например, мы можем выбрать все страны, имеющие общую границу с Чехией. Для этого можно использовать топологическое отношение <code>st_touches</code> вместо <code>st_intersects</code> — это будет гарантировать, что сама Чехия в результате не выберется (касающиеся объекты не могут перекрываться). Тип отношения необходимо поставить в параметр <code>op =</code> при выполнении фильтрации фрейма данных:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>cz <span class="ot">=</span> <span class="fu">filter</span>(countries, sovereignt <span class="sc">==</span> <span class="st">'Czechia'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>neighbors <span class="ot">=</span> countries[cz, op <span class="ot">=</span> st_touches]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(neighbors), <span class="at">col =</span> <span class="st">'lightgray'</span>, <span class="at">lwd =</span> <span class="fl">0.5</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cz, <span class="at">col =</span> <span class="st">'darkgray'</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="zones" class="level3" data-number="13.2.4">
<h3 data-number="13.2.4" class="anchored" data-anchor-id="zones"><span class="header-section-number">13.2.4</span> Зоны окружения объектов</h3>
<p>Весьма часто в качестве контекстного множества используются не реальные пространственные объекты, а набор абстрактных геометрических объектов, каждый из которых является производным от оригинального пространственного объекта. Как правило, такие геометрии представляют из себя <em>зоны окружения</em> объектов, построенные по некоторому формальному признаку.</p>
<p>Методы построения зон окружения можно разделить по двум критериям: учету взаимного размещения объектов (абсолютные и конкурентные зоны) и пространству признаков, в котором эти зоны строятся.</p>
<p>Если зоны окружения строятся без учета взаимного размещения объектов, то есть, независимо для каждого объекта, то мы будем называть их абсолютными. Абсолютные зоны окружения строятся путем фиксации порогового расстояния либо времени движения относительно исходного объекта. Такие зоны носят название буферных зон (по расстоянию) или зон доступности (по времени). Границей абсолютной зоны окружения является изолиния, построенная по соответствующему показателю. В случае времени это будет <em>изохрона</em>. Примеры абсолютных зон окружения:</p>
<ul>
<li>Водоохранная зона реки 200 метров (буферная зона)</li>
<li>Площадь городской территории, в любую точку которой вы можете доехать из дома на машине в течение 30 минут (зона доступности)</li>
</ul>
<p>Если же при построении зон окружения учитывается взаимное размещение объектов, то в данном случае зоны доступности строятся не исходя из порогового значения показателя (хотя оно может использоваться дополнительно), а исходя из того, какой объект является ближайшим. Конкурентные зоны окружения представляют собой <a href="https://ru.wikipedia.org/wiki/Разбиение_множества">разбиение</a> пространства на неперекрывающиеся участки без дыр, каждый из которых является зоной окружения соответствующего пространственного объекта. При этом любая точка внутри зоны окружения объекта ближе к этому объекту по выбранному признаку (времени или расстоянию), нежели к любому другому объекту. Конкурентные зоны окружения, построенные по расстоянию, можно реализовать средствами <a href="https://ru.wikipedia.org/wiki/Диаграмма_Вороного">диаграммы Вороного</a>.</p>
</section>
</section>
<section id="use_case" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="use_case"><span class="header-section-number">13.3</span> Постановка задач и изучение данных</h2>
<p>В настоящем модуле мы рассмотрим вышеперечисленные методы на примере анализа размещения пунктов общественного питания — кафе, ресторанов и т.д. Используя методы пространственного анализа в среде R, мы ответим на следующие вопросы:</p>
<ul>
<li>Какие улицы являются местами наибольшей концентрации заведений общественного питания?</li>
<li>Как распределены заведения общественного питания по районам центра Москвы?</li>
<li>Какие заведения общественного питания находятся вблизи метро и на берегу реки?</li>
<li>В какие заведения общественного питания можно доехать от выбранной точки в течение 5 минут?</li>
<li>Каков оптимальный маршрут между вашим местоположением и заведением, в котором вы хотите пообедать?</li>
</ul>
<p>В качестве источника данных используем <a href="http://www.openstreetmap.org">OpenStreetMap</a> — краудсорсинговый интернет-проект по созданию бесплатных и открытых пространственных данных глобального охвата. Данные OpenStreetMap в удобном для использования в ГИС виде доступны на <a href="http://beryllium.gis-lab.info/project/osmshp/">портале GIS-Lab</a>.</p>
<p>Для решения задач настоящего модуля нам понадобятся следующие дополнительные пакеты, которые мы не использовали ранее:</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/osrm/index.html">osrm</a> — построение зон доступности, маршрутов и матриц корреспонденции онлайн на основе данных OpenStreetMap и <a href="http://project-osrm.org">OSRM API</a>.</li>
<li><a href="https://riatelab.github.io/mapsf/">mapsf</a> — пакет, облегчающий построение тематических карт и легенд средствами стандартной функции <code>plot()</code>.</li>
</ul>
<p>Начнем наше исследование с визуального анализа исходных данных</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Чтение данных</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">=</span> <span class="fu">read_sf</span>(<span class="st">"data/roads.gpkg"</span>) <span class="co"># Дороги</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>poi <span class="ot">=</span> <span class="fu">read_sf</span>(<span class="st">"data/poi_point.gpkg"</span>) <span class="co"># Точки интереса</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>rayons <span class="ot">=</span> <span class="fu">read_sf</span>(<span class="st">"data/boundary_polygon.gpkg"</span>) <span class="co"># Границы районов</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>stations <span class="ot">=</span> <span class="fu">read_sf</span>(<span class="st">"data/metro_stations.gpkg"</span>) <span class="co"># Станции метро</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>water <span class="ot">=</span> <span class="fu">read_sf</span>(<span class="st">"data/water_polygon.gpkg"</span>) <span class="co"># Водные объекты</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Прочитаем текущие параметры компоновки</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>def <span class="ot">=</span> <span class="fu">par</span>(<span class="at">no.readonly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Уберем поля, чтобы карта занимала весь экран</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Получим ограничивающий прямоугольник слоя дорог в качестве общего охвата карты</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>frame <span class="ot">=</span> roads <span class="sc">|&gt;</span> <span class="fu">st_bbox</span>() <span class="sc">|&gt;</span> <span class="fu">st_as_sfc</span>() <span class="sc">|&gt;</span> <span class="fu">st_geometry</span>()</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="do">## ОБЗОР ИСХОДНЫХ ДАННЫХ -------------------------------------</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Визуализируем входные данные</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>basemap <span class="ot">=</span> <span class="cf">function</span>(<span class="at">add =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mf_base</span>(frame, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> add)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mf_base</span>(water, </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"lightskyblue1"</span>,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"lightskyblue3"</span>,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mf_base</span>(roads,</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"gray70"</span>, </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="fu">basemap</span>()</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_base</span>(poi, </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"deepskyblue4"</span>, </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.5</span>, </span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Теперь приступим к изучению данных, хранящихся в слое <code>poi</code> (от англ. POI — Point Of Interest). Данный слой содержит все точечные маркеры OSM, которыми были отмечены на карте объекты, представляющие (по мнению создателей данных) интерес для пользователей. В POI включаются самые разнообразные объекты, такие как: объекты сферы услуг (amenity), места для отдыха (leisure), офисные здания (office), магазины и торговые центры (shop), туристические достопримечательности (tourism), спортивные объекты (sport), примечательные инженерные сооружения (man_made). В наших данных информация разнесена по соответствующим полям, каждый объект снабжен уникальным идентификатором:</p>
<div class="cell">
<pre><code>## Simple feature collection with 6623 features and 9 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 410947.3 ymin: 6176678 xmax: 415889.9 ymax: 6181909
## Projected CRS: WGS 84 / UTM zone 37N
## # A tibble: 6,623 × 10
##        OSM_ID NAME           MAN_MADE LEISURE AMENITY OFFICE SHOP  TOURISM SPORT
##         &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;
##  1 2932331614 Арт-квартал    &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   doit… &lt;NA&gt;    &lt;NA&gt; 
##  2 3639408399 &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;    pharma… &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; 
##  3 3707882299 &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;    parkin… &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; 
##  4 3639408396 Стиль золото   &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   jewe… &lt;NA&gt;    &lt;NA&gt; 
##  5 3639408397 Цветочная баз… &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   flor… &lt;NA&gt;    &lt;NA&gt; 
##  6 1413216563 Азбука Вкуса   &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   supe… &lt;NA&gt;    &lt;NA&gt; 
##  7 3641139540 &lt;NA&gt;           &lt;NA&gt;     &lt;NA&gt;    waste_… &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; 
##  8 3636920934 Аршин          &lt;NA&gt;     &lt;NA&gt;    restau… &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; 
##  9 3644422074 Адамас         &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;    &lt;NA&gt;   jewe… &lt;NA&gt;    &lt;NA&gt; 
## 10 3424516009 Андерсон       &lt;NA&gt;     &lt;NA&gt;    restau… &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;    &lt;NA&gt; 
## # ℹ 6,613 more rows
## # ℹ 1 more variable: geometry &lt;POINT [m]&gt;</code></pre>
</div>
<p>Заведения общественного питания по классификатору OSM относятся к классу <em>amenity</em>. Поскольку данный классификатор представляет собой множество номинальных (категориальных) данных, можно начать изучение состава данных с помощью таблицы частот, которая строится средствами функции <code>table()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="fu">table</span>(poi<span class="sc">$</span>AMENITY))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="do">##                  Var1 Freq</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1         arts_centre   17</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                 atm  153</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                bank  407</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 4                 bar  161</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 5               bench  210</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 6     bicycle_parking   81</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 7      bicycle_rental  116</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 8          biergarten    1</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 9             brothel    1</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 10   bureau_de_change   21</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 11        bus_station    1</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 12               cafe  490</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 13         car_rental    1</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 14           car_wash   12</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 15   charging_station    1</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 16         child_care    1</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 17             cinema   16</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 18             clinic   51</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 19              clock   10</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 20            college    5</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 21         commercial    1</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 22   community_centre    4</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 23         courthouse    3</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 24     dancing_school    1</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="do">## 25            dentist   58</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 26            doctors   22</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="do">## 27     drinking_water    3</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="do">## 28     driving_school    2</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="do">## 29            embassy   31</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="do">## 30    emergency_phone    5</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="do">## 31          fast_food  169</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="do">## 32     ferry_terminal    5</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="do">## 33         food_court    3</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="do">## 34           fountain   32</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="do">## 35               fuel    8</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="do">## 36                gym    1</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="do">## 37           hospital    2</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="do">## 38              hotel    1</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="do">## 39          ice_cream    3</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="do">## 40       kindergarten   13</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="do">## 41            library   17</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="do">## 42     musical_school    1</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="do">## 43          nightclub   19</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="do">## 44           official    1</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="do">## 45            parking   92</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="do">## 46   parking_entrance   72</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="do">## 47      parking_space    1</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="do">## 48   payment_terminal    6</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="do">## 49           pharmacy  166</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="do">## 50           photolab    1</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="do">## 51   place_of_worship   23</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="do">## 52             police   21</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="do">## 53           post_box    4</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="do">## 54        post_office   37</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="do">## 55                pub   96</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="do">## 56    public_bookcase    2</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="do">## 57    public_building    8</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="do">## 58          recycling    6</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="do">## 59    register_office    2</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a><span class="do">## 60         restaurant  844</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="do">## 61             school   10</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a><span class="do">## 62            shelter    2</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="do">## 63               shop    4</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a><span class="do">## 64    social_facility    3</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a><span class="do">## 65          stripclub    4</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a><span class="do">## 66               taxi    1</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a><span class="do">## 67          telephone   58</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a><span class="do">## 68            theatre   48</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a><span class="do">## 69            toilets   82</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a><span class="do">## 70           training   15</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a><span class="do">## 71         university   15</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a><span class="do">## 72 vehicle_inspection    1</span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a><span class="do">## 73    vending_machine   98</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a><span class="do">## 74       waste_basket   52</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a><span class="do">## 75     waste_disposal  102</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Для дальнейшего анализа отберем из всего множества объектов сферы услуг заведения, где можно поесть: рестораны, кафе, бары, пабы и заведения быстрого питания (фастфуд). В классификаторе OSM эти заведения имеют тип <em>restaurant</em>, <em>bar</em>, <em>cafe</em>, <em>pub</em> и <em>fast_food</em>. Для отбора нужных строк и столбцов используем dplyr:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>poi_food <span class="ot">=</span> poi <span class="sc">|&gt;</span>  </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, AMENITY) <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(AMENITY <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"restaurant"</span>, <span class="st">"bar"</span>, <span class="st">"cafe"</span>, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"pub"</span>, <span class="st">"fast_food"</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(poi_food)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Simple feature collection with 6 features and 2 fields</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Geometry type: POINT</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Dimension:     XY</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Bounding box:  xmin: 410954.9 ymin: 6178842 xmax: 411023.8 ymax: 6181896</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Projected CRS: WGS 84 / UTM zone 37N</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 6 × 3</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="do">##   NAME        AMENITY              geometry</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="do">##   &lt;chr&gt;       &lt;chr&gt;             &lt;POINT [m]&gt;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 1 Аршин       restaurant (410975.2 6181661)</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 Андерсон    restaurant (410954.9 6180118)</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 Holynoot    fast_food  (410958.8 6179938)</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 Gayane's    restaurant (410958.4 6178842)</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 Molon Lave  restaurant (411013.7 6181448)</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 Шоколадница cafe       (411023.8 6181896)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distance_analysis" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="distance_analysis"><span class="header-section-number">13.4</span> Анализ расстояний</h2>
<p>Метрические отношения связывают объекты в терминах расстояний между ними. Предположим, что мы хотим определить улицы, являющиеся сосредоточением заведений питания. Один из вариантов решения состоит в том, чтобы для каждого пункта обслуживания определить ближайшую к нему улицу и далее для каждой улицы просуммировать количество раз, которое улиц оказалось ближайшей. Подробнее алгоритм решения выглядит следующим образом:</p>
<ol type="1">
<li>Вычислить матрицу расстояний между пунктами обслуживания и улицами. Размер матрицы <span class="math inline">\(M \times N\)</span>, где <span class="math inline">\(M\)</span> — количество улиц (строк), <span class="math inline">\(N\)</span> — количество пунктов (столбцов)</li>
<li>Найти в каждом столбце минимальное расстояние.</li>
<li>Получить идентификатор улицы (номер строки), соответствующий данному расстоянию.</li>
<li>Записать идентификатор в выходной вектор.</li>
</ol>
<p>Таким образом, мы получим вектор из идентификаторов улиц, при этом каждый идентификатор будет встречаться в этом векторе столько раз, сколько раз данная улица оказалась ближайшей к какому-то объекту.</p>
<p>Вычислим матрицу расстояний с помощью функции <code>st_distance()</code> из пакета <strong>sf</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="do">## АНАЛИЗ РАССТОЯНИЙ -------------------------------------</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>dist_matrix <span class="ot">=</span> <span class="fu">st_distance</span>(roads, poi_food)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># посмотрим, как выглядит результат на примере первых пяти объектов</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dist_matrix[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Units: [m]</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="do">##          [,1]      [,2]      [,3]      [,4]     [,5]</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="do">## [1,] 4962.292 3420.6849 3240.2066 2145.2044 4748.686</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [2,] 2247.737  705.2923  524.9411  570.3986 2035.341</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [3,] 2213.236  670.7904  490.4167  605.1606 2000.759</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="do">## [4,] 2197.874  655.4285  475.0629  620.4411 1985.242</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [5,] 3910.957 2368.5560 2188.1348 1092.5472 3698.246</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Далее необходимо в каждом столбце матрицы найти номер строки с минимальным расстоянием. Для этого необходимо получить порядок сортировки элементов по возрастанию значений данного столбца и взять номер первого элемента. Операцию можно применить с помощью <code>apply</code> ко всем столбцам:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">=</span> <span class="fu">apply</span>(dist_matrix, <span class="dv">2</span>, <span class="cf">function</span>(X) <span class="fu">order</span>(X)[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Теперь применим уже знакомую нам функцию <code>table()</code>, чтобы подсчитать, сколько раз каждая улица оказалась наиболее близкой. Далее присоединим статистику к исходным улицам, однако для этого нам потребуется вынести названия строк (номеров) улиц в отдельный столбец.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>count_stats <span class="ot">=</span> ids <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ids =</span> <span class="fu">as.integer</span>(ids))</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>roads <span class="ot">=</span> roads <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>())</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>roads_poi <span class="ot">=</span> <span class="fu">left_join</span>(roads, </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                   count_stats, </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'id'</span> <span class="ot">=</span> <span class="st">'ids'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Посмотрим первые 10 улиц по количеству общепита:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Статистика по улицам в табличном представлении (первые 10)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>roads_poi <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NAME, n) <span class="sc">|&gt;</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Simple feature collection with 10 features and 2 fields</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Geometry type: MULTILINESTRING</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Dimension:     XY</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Bounding box:  xmin: 411105.1 ymin: 6178083 xmax: 414504.1 ymax: 6181734</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Projected CRS: WGS 84 / UTM zone 37N</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 10 × 3</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="do">##    NAME                        n                                        geometry</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;                   &lt;int&gt;                           &lt;MULTILINESTRING [m]&gt;</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 улица Арбат                43 ((412157.9 6179399, 412148.5 6179396, 412147.2…</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 улица Новый Арбат          24 ((411105.1 6179409, 411112.5 6179408, 411162.7…</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Цветной бульвар            22 ((413491.7 6181734, 413493.8 6181729, 413495.6…</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Мясницкая улица            20 ((414504.1 6180781, 414499.7 6180779, 414497.2…</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Никольская улица           17 ((413704.5 6180101, 413701.3 6180097, 413674.4…</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Пятницкая улица            17 ((413895.8 6178083, 413896.4 6178095, 413899 6…</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Козицкий переулок          14 ((412831.7 6180834, 412822.5 6180829, 412782.6…</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 улица Большая Дмитровка    14 ((413262.7 6180062, 413238.1 6180094, 413201.5…</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Неглинная улица            14 ((413498.2 6180132, 413492.5 6180151, 413461.7…</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 улица Рождественка         14 ((413628.1 6180466, 413629.8 6180464, 413630.7…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Для завершения анализа осталось визуализировать результаты:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">basemap</span>()</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(roads_poi,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">'prop'</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">var =</span> <span class="fu">c</span>(<span class="st">'n'</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">'red'</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_base</span>(poi_food, </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"deepskyblue4"</span>, </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="dv">1</span>, </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="topology_analysis" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="topology_analysis"><span class="header-section-number">13.5</span> Анализ взаимного положения (топологический)</h2>
<p>Пространственные запросы, основанные на топологических отношениях, позволяют находить объекты, находящиеся внутри других объектов, соприкасающиеся с другими объектами, пересекающиеся с ними и так далее. Топологические отношения сохраняются при взаимно-однозначных и непрерывных преобразованиях плоскости.</p>
<p>Отличия от метрических отношений легко пояснить на примере преобразования проекции. Представьте, что карту России в <a href="http://geocnt.geonet.ru/projections/html/viewer.html">конической проекции</a> с концентрическими параллелями (известную по учебникам и атласам) вы трансформировали в карту России в проекции Меркатора (такую же как на <a href="https://www.google.ru/maps/place/Россия/">Google Maps</a>). Изогнутые параллели превратились в прямые линии; форма регионов, площади и расстояния между населенными пунктами значительно изменились. Однако Красноярск по-прежнему находится в Красноярском крае, Ярославль — на реке Волге, Нижний Новгород — на правом берегу Волги, озеро Белое — внутри Вологодской области, а Московская область как не граничила с Тамбовской, так и не граничит после трансформации проекции. Это и есть топологические отношения.</p>
<p>Формально топологические отношения в ГИС описываются с помощью <a href="https://en.wikipedia.org/wiki/DE-9IM">модели девяти пересечений DE-9IM</a>, которая была рассмотрена в начале этой лекции.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## АНАЛИЗ ВЗАИМНОГО ПОЛОЖЕНИЯ -------------------------------------</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>poi_food <span class="ot">=</span> poi_food <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">count =</span> <span class="dv">1</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>rayons_poi <span class="ot">=</span> <span class="fu">aggregate</span>(poi_food[<span class="st">'count'</span>], rayons, sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Преобразуем результат в относительный показатель</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># (единиц на кв.км. площади) и запишем в таблицу районов:</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rayons_poi<span class="sc">$</span>density <span class="ot">=</span> <span class="dv">1000000</span> <span class="sc">*</span> rayons_poi<span class="sc">$</span>count <span class="sc">/</span> <span class="fu">st_area</span>(rayons_poi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Масштабный множитель 1000000 в коде понадобился чтобы перевести площадь, хранящуюся в поле Shape_Area из квадратных метров в квадратные километры. Обратите внимание на то, что в данном случае мы не стали ограничивать фигурными скобками тело анонимной функции (<code>table(X)[2]</code>) внутри <code>apply()</code>, поскольку выполняемая операция достаточно компактна.</p>
<p>Визуализируем результат:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(rayons_poi,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">var =</span> <span class="st">'density'</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">'choro'</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="st">"Заведений</span><span class="sc">\n</span><span class="st">на 1 кв.км"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">basemap</span>(<span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_base</span>(rayons,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">"black"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_label</span>(rayons,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">var =</span> <span class="st">'NAME'</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">'black'</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">overlap =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">font =</span> <span class="dv">2</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Итак, используя топологический пространственный запрос “Содержит”, мы смогли агрегировать точечные объекты внутри площадных и построить картограммы плотности распределения пунктов питания по районам центра Москвы.</p>
</section>
<section id="absolute_zones" class="level2" data-number="13.6">
<h2 data-number="13.6" class="anchored" data-anchor-id="absolute_zones"><span class="header-section-number">13.6</span> Анализ абсолютных зон окружения</h2>
<p>Задача данного раздела модуля звучит следующим образом: определить, какие пункты питания находятся в радиусе 300 метров от метро “Кропоткинская”. Контекстом анализа в данном случае служит 300-метровая зона окружения станции метро. Поставленную задачу можно решить двумя способами:</p>
<ul>
<li>Рассчитать расстояния от каждого пункта питания до станции метро “Кропоткинская” и выбрать точки, для которых это расстояние меньше или равно 300 метрам.</li>
<li>Построить буферную зону радиусом 300 метров и выбрать ею точки, используя топологическое отношение пересечения</li>
</ul>
<p>Мы будем использовать второй вариант решения. Алгоритм выглядит следующим образом:</p>
<ol type="1">
<li>Построить буферную зону, используя функцию <code>st_buffer()</code> из пакета <strong>sf</strong>.</li>
<li>Выбрать полученной зоной точки пунктов питания, используя стандартный оператор <code>[]</code>.</li>
<li>Визуализировать на карте полученные точки и буферную зону.</li>
</ol>
<p>Определим расширенную функцию <code>basemap2()</code>, которая будет рисовать объекты картографической основы, ее мы будем использовать далее.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## АНАЛИЗ АБСОЛЮТНЫХ ЗОН ОКРУЖЕНИЯ -------------------------------------</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>stations<span class="sc">$</span>label <span class="ot">=</span> <span class="st">'М'</span> <span class="co"># пригодится для подписей</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Функция отвечает за рисование базовой карты</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>basemap2 <span class="ot">=</span> <span class="cf">function</span>(<span class="at">add =</span> <span class="cn">FALSE</span>){</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mf_base</span>(frame, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">add =</span> add)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mf_base</span>(water, </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"lightskyblue1"</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> <span class="st">"lightskyblue3"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mf_base</span>(roads,</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"gray70"</span>, </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mf_base</span>(poi_food, </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"deepskyblue4"</span>, </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>, <span class="at">cex =</span> <span class="fl">0.5</span>, </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mf_base</span>(stations, </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"slategray4"</span>, </span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="dv">3</span>, </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mf_label</span>(stations,</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">var =</span> <span class="st">'label'</span>,</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"white"</span>,</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.6</span>)</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Определив вспомогательные функции, можем приступать к выполнению анализа:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Выберем станцию метро и построим буферную зону</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>krop <span class="ot">=</span> <span class="fu">filter</span>(stations, NAME <span class="sc">==</span> <span class="st">"Кропоткинская"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>zone <span class="ot">=</span> <span class="fu">st_buffer</span>(krop, <span class="at">dist =</span> <span class="dv">500</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Применим разработанную функцию для отбора точек</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>selected_poi <span class="ot">=</span> poi_food[zone, ]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Применим разработанную функцию для рисования картографической основы</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">basemap2</span>()</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Визуализируем результаты анализа</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_base</span>(zone,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">adjustcolor</span>(<span class="st">"sienna3"</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">"sienna3"</span>,</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_base</span>(selected_poi, </span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"sienna4"</span>, </span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="dv">1</span>, </span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_base</span>(krop, </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>   <span class="at">col =</span> <span class="st">"red"</span>, </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>   <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>   <span class="at">cex =</span> <span class="dv">4</span>, </span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>   <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_label</span>(krop,</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>   <span class="at">var =</span> <span class="st">'label'</span>,</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>   <span class="at">col =</span> <span class="st">"white"</span>,</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>   <span class="at">cex =</span> <span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<pre><code>## Simple feature collection with 39 features and 3 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 411944.2 ymin: 6178233 xmax: 412839 ymax: 6179056
## Projected CRS: WGS 84 / UTM zone 37N
## # A tibble: 39 × 4
##    NAME          AMENITY              geometry count
##    &lt;chr&gt;         &lt;chr&gt;             &lt;POINT [m]&gt; &lt;dbl&gt;
##  1 Журфак        restaurant (411944.2 6178611)     1
##  2 Гоголь-моголь cafe       (411968.6 6178588)     1
##  3 Манкс &amp; Нанс  bar        (412029.5 6178819)     1
##  4 5 специй      restaurant (412045.3 6178814)     1
##  5 45            bar        (412063.1 6178771)     1
##  6 Генацвале     restaurant (412072.2 6178255)     1
##  7 Чемодан       restaurant (412092.2 6179000)     1
##  8 Азия Кафе     restaurant (412142.7 6178592)     1
##  9 Лица          restaurant   (412139 6178358)     1
## 10 Баба Марта    restaurant (412154.8 6178720)     1
## # ℹ 29 more rows</code></pre>
</div>
<p>В качестве примера аналогичного анализа отберем все пункты питания, находящиеся в пределах 100 метров от реки Москвы:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>river <span class="ot">=</span> water <span class="sc">|&gt;</span> <span class="fu">filter</span>(NAME <span class="sc">==</span> <span class="st">"Москва"</span>) <span class="sc">|&gt;</span> <span class="fu">st_union</span>()</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>zone <span class="ot">=</span> <span class="fu">st_buffer</span>(river, <span class="at">dist =</span> <span class="dv">100</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>selected_poi <span class="ot">=</span> poi_food[zone, ]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">basemap2</span>()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Визуализируем результаты анализа</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_base</span>(zone,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">adjustcolor</span>(<span class="st">"sienna3"</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">"sienna3"</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_base</span>(river,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="fu">adjustcolor</span>(<span class="st">"cyan"</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">"black"</span>,</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_base</span>(selected_poi, </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"red"</span>, </span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">20</span>, </span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">1.5</span>, </span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<pre><code>## Simple feature collection with 39 features and 3 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 411661.2 ymin: 6176685 xmax: 415287.1 ymax: 6178953
## Projected CRS: WGS 84 / UTM zone 37N
## # A tibble: 39 × 4
##    NAME                 AMENITY              geometry count
##    &lt;chr&gt;                &lt;chr&gt;             &lt;POINT [m]&gt; &lt;dbl&gt;
##  1 Белый журавль        restaurant (411661.2 6177029)     1
##  2 What's Up Dog!       fast_food  (411871.8 6176685)     1
##  3 Coffee@Парк Горького cafe       (411917.7 6176775)     1
##  4 Sekta                restaurant   (411975 6176908)     1
##  5 GlowSubs             fast_food  (412060.5 6177161)     1
##  6 Чай &amp; кофе           cafe       (412197.5 6177284)     1
##  7 Академия             restaurant (412222.4 6177790)     1
##  8 Kaffebrod            cafe       (412280.3 6177452)     1
##  9 Les                  cafe       (412299.1 6177468)     1
## 10 Beefbar              restaurant (412344.9 6177823)     1
## # ℹ 29 more rows</code></pre>
</div>
</section>
<section id="conc_zones" class="level2" data-number="13.7">
<h2 data-number="13.7" class="anchored" data-anchor-id="conc_zones"><span class="header-section-number">13.7</span> Анализ конкурентных зон окружения</h2>
<p>В данном разделе мы решим следующую задачу: разбить всю изучаемую территорию на зоны окружения станций метро и подсчитать количество пунктов питания, попадающих в каждую зону. Полученные зоны должны быть конкурентными: любая точка, находящаяся в зоне окружения конкретной станции метро, должна быть ближе к этой станции, чем к любой другой станции.</p>
<p>Ранее мы говорили о том, что конкурентные зоны окружения по расстоянию можно реализовать с помощью диаграммы Вороного. Применим функцию <code>st_voronoi()</code> из пакета <strong>sf</strong>, чтобы посмотреть, как выглядит диаграмма Вороного для точек станций метро:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="do">## АНАЛИЗ КОНКУРЕНТНЫХ ЗОН ОКРУЖЕНИЯ -------------------------------------</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>zones <span class="ot">=</span> stations <span class="sc">|&gt;</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_combine</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_voronoi</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_collection_extract</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_crop</span>(frame)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_base</span>(zones)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_base</span>(stations, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">'black'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Для визуализации результатов мы будем использовать метод картодиаграмм (пропорциональных символов), реализованный в функции <code>propSymbolsLayer()</code> пакета <code>cartography</code>. Размером кружка покажем количество пунктов питания, оказавшихся в каждой зоне окружения:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Агрегруем данные по каждой зоне</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>zones_poi <span class="ot">=</span> <span class="fu">aggregate</span>(poi_food[<span class="st">'count'</span>], zones, sum)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Визуализируем результат</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">basemap2</span>()</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_base</span>(zones, <span class="at">col =</span> <span class="fu">adjustcolor</span>(<span class="st">"white"</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(zones_poi, <span class="at">var =</span> <span class="st">'count'</span>, <span class="at">type =</span> <span class="st">'prop'</span>, </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">adjustcolor</span>(<span class="st">"turquoise3"</span>, <span class="at">alpha.f =</span> <span class="fl">0.5</span>),</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">border =</span> F,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">leg_title =</span> <span class="st">"Заведений</span><span class="sc">\n</span><span class="st">питания"</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_label</span>(zones_poi, </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">var =</span> <span class="st">'count'</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"turquoise4"</span>,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fu">log</span>(zones_poi<span class="sc">$</span>count)<span class="sc">/</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="areal_interpolation" class="level2" data-number="13.8">
<h2 data-number="13.8" class="anchored" data-anchor-id="areal_interpolation"><span class="header-section-number">13.8</span> Интерполяция, взвешенная на площадь</h2>
<p>В некоторых случаях необходимо осуществить так называемую интерполяцию, взвешенную на площадь. Данный метод применяется в тех случаях, когда исходная информация привязана не к точечным, а к площадным объектам. Задача заключается в том, чтобы с одной площадной сетки перенести на другую (как правило, регулярную, обладающую большей дискретностью). Необходимость подобного преобразования может быть обусловлена следующими (но и не только) причинами:</p>
<ul>
<li>метод анализа (например, моделирование диффузии) предполагает, что данные распределены по регулярной сетке, в то время как исходная сетка нерегулярна.</li>
<li>необходимо обеспечить сравнимость пространственных распределений показателя для разных территорий, в то время как дробность исходного территориального деления существенно меняется в пространстве.</li>
</ul>
<p>Метод интерполяции по ареалам реализуется средствами функции <code>st_interpolate_aw()</code> из пакета <strong>sf</strong>. Данной функции необходимо подать исходную и целевую полигональную сетку, а также указать тип параметра: <em>интенсивный</em> или <em>экстенсивный</em>:</p>
<p>— <em>экстенсивные</em> параметры суммируются и делятся при агрегировании/агрегировании территориальных единиц. Например, площадь, покрытая лесом или численность населения — это экстенсивный параметр. - <em>интенсивные</em> параметры осредняются или остаются постоянными при агрегировании/дизагрегировании территориальных единиц. Например, густота древостоя и плотность населения — интенсивные параметры.</p>
<p>Рассмотрим это метод интерполяции на примере данных по графствам Северной Каролины (показатель — количество новорожденных в 1974 году). Для расчета векторной регулярной сетки используем функцию <code>st_make_grid()</code> из пакета <strong>sf</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Данные по Северной Каролине</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>nc <span class="ot">=</span> <span class="fu">st_read</span>(<span class="fu">system.file</span>(<span class="st">"shape/nc.shp"</span>, <span class="at">package=</span><span class="st">"sf"</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Reading layer `nc' from data source </span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   `/Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/library/sf/shape/nc.shp' </span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   using driver `ESRI Shapefile'</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Simple feature collection with 100 features and 14 fields</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Geometry type: MULTIPOLYGON</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Dimension:     XY</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Geodetic CRS:  NAD27</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>cells <span class="ot">=</span> <span class="fu">st_make_grid</span>(nc, <span class="at">cellsize =</span> <span class="fl">0.25</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>birth <span class="ot">=</span> <span class="fu">st_interpolate_aw</span>(nc[<span class="st">"BIR74"</span>], </span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>                       cells, </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">extensive =</span> <span class="cn">FALSE</span>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># исходное распределение</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(nc, <span class="at">var =</span> <span class="st">'BIR74'</span>, <span class="at">type =</span> <span class="st">'choro'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># пересчет на регулярную сетку</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_map</span>(birth, <span class="at">var =</span> <span class="st">'BIR74'</span>, <span class="at">type =</span> <span class="st">'choro'</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mf_base</span>(nc, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">'white'</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="дирекционные-отношения" class="level2" data-number="13.9">
<h2 data-number="13.9" class="anchored" data-anchor-id="дирекционные-отношения"><span class="header-section-number">13.9</span> Дирекционные отношения</h2>
<section id="circular_circ" class="level3" data-number="13.9.1">
<h3 data-number="13.9.1" class="anchored" data-anchor-id="circular_circ"><span class="header-section-number">13.9.1</span> Статистика направлений</h3>
<section id="circular_circ_theory" class="level4" data-number="13.9.1.1">
<h4 data-number="13.9.1.1" class="anchored" data-anchor-id="circular_circ_theory"><span class="header-section-number">13.9.1.1</span> Теория</h4>
<p>В географии направления играют огромную роль. Ветер, морские течения, уличная сеть, перелеты птиц — эти явления можно охарактеризовать их направленностью. Для того, чтобы эффективно анализировать такие данные, необходимо владеть специализированным математическим аппаратом.</p>
<p>Обработкой данных о направлениях занимается особая область математической статистики — <strong>статистика направлений</strong>, или <strong>круговая (циркулярная)</strong> статистика (Mardia, Jupp, 2000; Pewsey et al., 2013). В круговой статистике каждое направление <span class="math inline">\(\theta \in [0, 2\pi)\)</span> представляется в виде вектора <span class="math inline">\(x = (\cos \theta, sin \theta)\)</span>. Все операции производятся над подобными векторами и их координатами. Аналогом нормального распределения для круговой случайной величины является распределение фон Мизеса (von Mises, 1918), которое задается функцией плотности вероятности: <span class="math display">\[
f(θ)=\frac{1}{2 \pi I_0(\kappa)} e^{\kappa \cos (\theta - \mu)},
\]</span></p>
<p>где <span class="math inline">\(\kappa \geq 0\)</span> — параметр концентрации, <span class="math inline">\(\mu\)</span> — среднее значение (для <span class="math inline">\(\kappa &gt; 0\)</span>) и</p>
<p><span class="math display">\[
I_p(\kappa) = \frac{1}{2π} \int_{0}^{2\pi} \cos (p \theta) e^{\kappa \cos θ} d \theta
\]</span> есть модифицированная функция Бесселя первого рода и порядка <span class="math inline">\(p\)</span>. Из формул видно, что по своему эффекту параметр концентрации противоположен среднеквадратическому отклонению <span class="math inline">\(\sigma\)</span>, которое является параметром нормального распределения. Чем больше значение <span class="math inline">\(\kappa\)</span>, тем более сконцентрировано распределение относительно среднего значения — отсюда идет название этого параметра. Распределение фон Мизеса используется для построения ядра при аппроксимации плотности распределения направлений методом <a href="https://en.wikipedia.org/wiki/Kernel_density_estimation">ядерной оценки</a> (оценки по методу Парзена-Розенблатта).</p>
<blockquote class="blockquote">
<p>В метеорологии значения <span class="math inline">\(\cos \theta\)</span> и <span class="math inline">\(\sin \theta\)</span> определяют соотношение <strong>зональной</strong> и <strong>меридиональной</strong> составляющей скорости [ветра] (для получения самих составляющих их надо умножить на скорость ветра).</p>
</blockquote>
<p>Для вычисления статистических моментов круговой случайной величины требуется найти средний равнодействующий вектор первого порядка: <span class="math display">\[R = (C, S),\]</span> где</p>
<p><span class="math display">\[C = \frac{1}{n} \sum_{j=1}^{n} \cos \theta_j,\\
S = \frac{1}{n} \sum_{j=1}^{n} \sin \theta_j.\]</span></p>
<p>Данный вектор имеет направление <span class="math inline">\(\bar\theta\)</span>, которое является <strong>выборочным средним направлением</strong> исследуемой величины.</p>
<p><strong>Выборочная средняя равнодействующая длина</strong> <span class="math inline">\(\bar R = \sqrt{C^2 + S^2}\)</span> принимает значения в диапазоне <span class="math inline">\([0, 1]\)</span> и показывает меру концентрации направлений относительно <span class="math inline">\(\theta\)</span>. <span class="math inline">\(\bar R = 1\)</span> означает, что все исходные направления совпадают, <span class="math inline">\(\bar R = 0\)</span> — что данные равномерно распределены по кругу, либо распределение имеет несколько мод, которые уравновешивают друг друга.</p>
<p>Величина <span class="math inline">\(\bar R\)</span> дает важную информацию для предварительной диагностики картины направлений. Если значение <span class="math inline">\(\bar R\)</span> близко к единице, это означает, что распределение является унимодальным и в качестве основного направления можно принять значение <span class="math inline">\(\bar θ\)</span> <span class="citation" data-cites="mardia2000directional">(<a href="references.html#ref-mardia2000directional" role="doc-biblioref">Mardia and Jupp 2000</a>)</span>.</p>
<p><strong>Стандартное отклонение направлений</strong> <span class="math inline">\(v\)</span> в радианах может быть найдено как <span class="math inline">\(v=\sqrt{-2 \ln \bar R}\)</span> .</p>
<p>В ряде случаев противоположные направления считаются эквивалентными. Например, нельзя сказать, идет ли улица с юга на север или с севера на юг. Такие данные в теории круговой статистики называются <strong>аксиальными</strong> (Mardia, Jupp, 2000). Для аксиальных данных возможный диапазон значений лежит в интервале <span class="math inline">\([0, \pi)\)</span>. Поскольку методы круговой статистики рассчитаны на круговое замыкание данных, стандартный подход к обработке аксиальных данных предполагает переход от направлений к их удвоенным значениям <span class="math inline">\(\theta' = 2\theta\)</span>, обработку полученных значений стандартными методами и отображение полученных значение обратно на интервал <span class="math inline">\([0, \pi)\)</span>. Для среднего, медианы и моды распределения это означает простое деление полученного значения пополам <span class="citation" data-cites="pewsey2013circular">(<a href="references.html#ref-pewsey2013circular" role="doc-biblioref">Pewsey, Neuhäuser, and Ruxton 2013</a>)</span>.</p>
<p>Модальные направления могут быть определены как по гистограмме распределения, так и методом ядерной оценки. Основной вопрос поиска эффективного ядра заключается в параметризации функции <span class="math inline">\(K\)</span>. Для распределения фон Мизеса таким параметром является концентрация <span class="math inline">\(\kappa\)</span>. Чем больше этот параметр, тем более локализованной будет оценка, тем сильнее будут проявляться в ней существующие моды распределения, но также будут и выделяться новые моды, которые на самом деле не значимы. Малые значения <span class="math inline">\(\kappa\)</span> приведут, наоборот, к «размыванию» плотности распределения в пределах полного круга. Как и в случае с количеством интервалов гистограммы, избыточно малые и большие значения κ нежелательны.</p>
<p>В работе <span class="citation" data-cites="Oliveira2012">(<a href="references.html#ref-Oliveira2012" role="doc-biblioref">M. Oliveira, Crujeiras, and Rod’riguez-Casal 2012</a>)</span> показано, что оптимальное значение <span class="math inline">\(\kappa\)</span> может быть подобрано также для оценки распределений, являющихся конечной суммой <span class="math inline">\(M\)</span> распределений фон Мизеса, то есть, мультимодальных распределений, имеющих плотность : <span class="math display">\[g(\theta)=\sum_{i=1}^{M} \alpha_i \frac{\exp\lbrace{\kappa_i \cos(\theta - \mu_i)\rbrace}}{2 \pi I_0 (\kappa_i)},\]</span> где <span class="math inline">\(\sum_{i=1}^{M} = 1\)</span>.</p>
<p>Поскольку в результате подбора определяется не только параметр концентрации, но и число компонент в сумме распределений <span class="citation" data-cites="Oliveira2014">(<a href="references.html#ref-Oliveira2014" role="doc-biblioref">Ma’ria Oliveira, Crujeiras, and Rod’riguez-Casal 2014</a>)</span>, его можно также использовать для определения количества искомых мод, если это необходимо.</p>
<p>Когда подобрана функция ядра и ее параметры, оценка плотности распределения (вычисление функции <span class="math inline">\(\circ f _h (x)\)</span>) для круговых данных делается либо для исходных направлений <span class="math inline">\(\theta_j\)</span>, либо с равным (достаточно малым) интервалом — например, через 1 градус <span class="citation" data-cites="pewsey2013circular">(<a href="references.html#ref-pewsey2013circular" role="doc-biblioref">Pewsey, Neuhäuser, and Ruxton 2013</a>)</span>. После того как произведена оценка, могут быть выбраны направления, в которых функция плотности распределения достигает локального максимума — первого и второго по величине. Эти направления и будут соответствовать первой и второй моде распределения направлений.</p>
</section>
</section>
<section id="circular_circ_vis" class="level3" data-number="13.9.2">
<h3 data-number="13.9.2" class="anchored" data-anchor-id="circular_circ_vis"><span class="header-section-number">13.9.2</span> Практика</h3>
<p>В практической части данного раздела мы будем работать с массивом среднемесячных значений метеопараметров в пограничном слое атмосферы по полярным аэрологическим обсерваториям России. Массив данных ежемесячно обновляется на <a href="http://aisori-m.meteo.ru">портале Аисори-М</a> <a href="http://meteo.ru/"><strong>ВНИИГМИ-МЦД</strong></a>.</p>
<p>В системе доступны данные по следующим обсерваториям:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">=</span> <span class="fu">read_excel</span>(<span class="st">'data/bound/scheme.xlsx'</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">Индекс</th>
<th style="text-align: left;">Название</th>
<th style="text-align: right;">Широта</th>
<th style="text-align: right;">Долгота</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">20674</td>
<td style="text-align: left;">Остров Диксон</td>
<td style="text-align: right;">73.50</td>
<td style="text-align: right;">80.42</td>
</tr>
<tr class="even">
<td style="text-align: right;">21824</td>
<td style="text-align: left;">Тикси</td>
<td style="text-align: right;">71.35</td>
<td style="text-align: right;">128.55</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22113</td>
<td style="text-align: left;">Мурманск</td>
<td style="text-align: right;">68.59</td>
<td style="text-align: right;">33.07</td>
</tr>
<tr class="even">
<td style="text-align: right;">22217</td>
<td style="text-align: left;">Кандалакша</td>
<td style="text-align: right;">67.09</td>
<td style="text-align: right;">32.21</td>
</tr>
<tr class="odd">
<td style="text-align: right;">22271</td>
<td style="text-align: left;">Шойна</td>
<td style="text-align: right;">67.53</td>
<td style="text-align: right;">44.09</td>
</tr>
<tr class="even">
<td style="text-align: right;">23078</td>
<td style="text-align: left;">Норильск</td>
<td style="text-align: right;">69.20</td>
<td style="text-align: right;">88.18</td>
</tr>
<tr class="odd">
<td style="text-align: right;">23205</td>
<td style="text-align: left;">Нарьян-Мар</td>
<td style="text-align: right;">67.39</td>
<td style="text-align: right;">53.07</td>
</tr>
<tr class="even">
<td style="text-align: right;">23330</td>
<td style="text-align: left;">Салехард</td>
<td style="text-align: right;">66.32</td>
<td style="text-align: right;">66.40</td>
</tr>
<tr class="odd">
<td style="text-align: right;">24125</td>
<td style="text-align: left;">Оленек</td>
<td style="text-align: right;">68.31</td>
<td style="text-align: right;">112.26</td>
</tr>
<tr class="even">
<td style="text-align: right;">24266</td>
<td style="text-align: left;">Верхоянск</td>
<td style="text-align: right;">67.55</td>
<td style="text-align: right;">133.38</td>
</tr>
<tr class="odd">
<td style="text-align: right;">24343</td>
<td style="text-align: left;">Жиганск</td>
<td style="text-align: right;">66.46</td>
<td style="text-align: right;">123.21</td>
</tr>
<tr class="even">
<td style="text-align: right;">89512</td>
<td style="text-align: left;">Новолазаревская</td>
<td style="text-align: right;">-70.75</td>
<td style="text-align: right;">11.83</td>
</tr>
<tr class="odd">
<td style="text-align: right;">89592</td>
<td style="text-align: left;">Мирный</td>
<td style="text-align: right;">-66.65</td>
<td style="text-align: right;">19.71</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Для каждой обсерватории даны следующие параметры:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 54%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 13%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Призначная часть/ метеоэлемент/число наблюдений</th>
<th style="text-align: left;">Обозначение</th>
<th style="text-align: right;">Число цифр</th>
<th style="text-align: left;">Единицы измерения</th>
<th style="text-align: left;">Константа отсутствия</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Индекс станции</td>
<td style="text-align: left;">INDEX</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">нет</td>
</tr>
<tr class="even">
<td style="text-align: left;">Год</td>
<td style="text-align: left;">GGGG</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">нет</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Месяц</td>
<td style="text-align: left;">MM</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">нет</td>
</tr>
<tr class="even">
<td style="text-align: left;">Срок</td>
<td style="text-align: left;">HH</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">GMT</td>
<td style="text-align: left;">нет</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Стандартное значение высоты</td>
<td style="text-align: left;">Z</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">м</td>
<td style="text-align: left;">нет</td>
</tr>
<tr class="even">
<td style="text-align: left;">Среднемесячные значения давления</td>
<td style="text-align: left;">MP</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">10·гПа</td>
<td style="text-align: left;">-9999</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Среднеквадратические отклонения давления</td>
<td style="text-align: left;">SP</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">10·гПа</td>
<td style="text-align: left;">-9999</td>
</tr>
<tr class="even">
<td style="text-align: left;">Число наблюдений для давления</td>
<td style="text-align: left;">NP</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">нет</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Среднемесячные значения температуры</td>
<td style="text-align: left;">MT</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">10·°C</td>
<td style="text-align: left;">-9999</td>
</tr>
<tr class="even">
<td style="text-align: left;">Среднеквадратические отклонения температуры</td>
<td style="text-align: left;">ST</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">10·°C</td>
<td style="text-align: left;">-9999</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Число наблюдений для температуры</td>
<td style="text-align: left;">NT</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">нет</td>
</tr>
<tr class="even">
<td style="text-align: left;">Среднемесячные значения дефицита точки росы</td>
<td style="text-align: left;">MD</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">10·°C</td>
<td style="text-align: left;">-9999</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Среднеквадратические отклонения дефицита точки росы</td>
<td style="text-align: left;">SD</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">10·°C</td>
<td style="text-align: left;">-9999</td>
</tr>
<tr class="even">
<td style="text-align: left;">Число наблюдений для дефицита точки росы</td>
<td style="text-align: left;">ND</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">нет</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Среднемесячные значения скалярной скорости ветра</td>
<td style="text-align: left;">MS</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">10·м/с</td>
<td style="text-align: left;">-9999</td>
</tr>
<tr class="even">
<td style="text-align: left;">Среднеквадратические отклонения скалярной скорости ветра</td>
<td style="text-align: left;">SS</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">10·м/с</td>
<td style="text-align: left;">-9999</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Число наблюдений для скалярной скорости ветра</td>
<td style="text-align: left;">NS</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">нет</td>
</tr>
<tr class="even">
<td style="text-align: left;">Среднемесячные значения зональной составляющей скорости ветра</td>
<td style="text-align: left;">MU</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">10·м/с</td>
<td style="text-align: left;">-9999</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Среднеквадратические отклонения зональной составляющей скорости ветра</td>
<td style="text-align: left;">SU</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">10·м/с</td>
<td style="text-align: left;">-9999</td>
</tr>
<tr class="even">
<td style="text-align: left;">Число наблюдений для зональной составляющей скорости ветра</td>
<td style="text-align: left;">NU</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">нет</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Среднемесячные значения меридиональной составляющей скорости ветра</td>
<td style="text-align: left;">MV</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">10·м/с</td>
<td style="text-align: left;">-9999</td>
</tr>
<tr class="even">
<td style="text-align: left;">Среднеквадратические отклонения меридиональной составляющей скорости ветра</td>
<td style="text-align: left;">SV</td>
<td style="text-align: right;">6</td>
<td style="text-align: left;">10·м/с</td>
<td style="text-align: left;">-9999</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Число наблюдений для меридиональной составляющей скорости ветра</td>
<td style="text-align: left;">NV</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">нет</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Загрузим данные по всем обсерваториям из текстовых файлов в папке <em>bound</em>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>files <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">'data/bound'</span>, <span class="fu">list.files</span>(<span class="st">'data/bound'</span>, <span class="st">"*.txt"</span>), <span class="at">sep =</span> <span class="st">'/'</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>(<span class="at">tab =</span> <span class="fu">lapply</span>(files, <span class="cf">function</span>(X) {</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">read_table</span>(X, <span class="at">col_names =</span> params<span class="sc">$</span>Обозначение)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">|&gt;</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> </span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(obs, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'INDEX'</span> <span class="ot">=</span> <span class="st">'Индекс'</span>))) <span class="co"># присоединим информацию о названиях станций</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 77,073 × 26</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="do">##    INDEX  GGGG    MM    HH     Z    MP    SP    NP    MT    ST    NT    MD    SD</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 20674  2007     1     0  2000  7629    78    27  -187    35    27    53    46</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 20674  2007     1     0  1900  7732    79    27  -182    36    27    52    46</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 20674  2007     1     0  1800  7836    79    27  -178    36    27    51    45</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 20674  2007     1     0  1700  7942    80    27  -173    36    27    49    44</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 20674  2007     1     0  1600  8048    81    27  -168    36    27    48    44</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 20674  2007     1     0  1500  8157    81    27  -164    38    27    47    44</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 20674  2007     1     0  1400  8266    82    27  -160    39    27    45    44</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 20674  2007     1     0  1300  8376    82    27  -156    39    27    43    42</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 20674  2007     1     0  1200  8488    83    27  -152    40    27    40    40</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 20674  2007     1     0  1100  8601    83    27  -148    41    27    37    39</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 77,063 more rows</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 13 more variables: ND &lt;dbl&gt;, MS &lt;dbl&gt;, SS &lt;dbl&gt;, NS &lt;dbl&gt;, MU &lt;dbl&gt;,</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="do">## #   SU &lt;dbl&gt;, NU &lt;dbl&gt;, MV &lt;dbl&gt;, SV &lt;dbl&gt;, NV &lt;dbl&gt;, Название &lt;chr&gt;,</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="do">## #   Широта &lt;dbl&gt;, Долгота &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Создадим объект типа <code>circular</code> (из пакета <strong>circular</strong>) с направлениями ветра для анализа, и запишем его в новую переменую таблицы. Предварительно определим вспомогательную функцию, вычисляющую географический азимут на основе компонент скорости:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>geo_azimuth <span class="ot">=</span> <span class="cf">function</span>(dx, dy) {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">=</span> <span class="fu">atan2</span>(dx, dy)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(a <span class="sc">&lt;=</span> pi<span class="sc">/</span><span class="dv">2</span>, pi<span class="sc">/</span><span class="dv">2</span> <span class="sc">-</span> a,  <span class="dv">5</span><span class="sc">*</span>pi<span class="sc">/</span><span class="dv">2</span> <span class="sc">-</span> a)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>(<span class="at">winds =</span> tab <span class="sc">|&gt;</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wind =</span> <span class="fu">circular</span>(<span class="fu">geo_azimuth</span>(MV, MU), <span class="at">template =</span> <span class="st">'geographics'</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(INDEX, <span class="at">name =</span> Название, GGGG, MM, HH, Z, MU, MV, SS, wind))</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 77,073 × 10</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="do">##    INDEX name           GGGG    MM    HH     Z    MU    MV    SS wind      </span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;circular&gt;</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 20674 Остров Диксон  2007     1     0  2000    33    31    45 0.8166380 </span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 20674 Остров Диксон  2007     1     0  1900    32    32    45 0.7853982 </span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 20674 Остров Диксон  2007     1     0  1800    30    33    46 0.7378151 </span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 20674 Остров Диксон  2007     1     0  1700    29    35    47 0.6919214 </span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 20674 Остров Диксон  2007     1     0  1600    28    38    49 0.6350267 </span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 20674 Остров Диксон  2007     1     0  1500    26    40    50 0.5763752 </span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 20674 Остров Диксон  2007     1     0  1400    25    41    51 0.5475622 </span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 20674 Остров Диксон  2007     1     0  1300    25    42    54 0.5369107 </span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 20674 Остров Диксон  2007     1     0  1200    24    45    56 0.4899573 </span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 20674 Остров Диксон  2007     1     0  1100    24    49    58 0.4554511 </span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 77,063 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Выберем данные по высоте 0 метров за 12 часов дня для поселка Тикси, сохранив только составляющие скорости и ее скалярную величину:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">tiksi_wind =</span> winds <span class="sc">|&gt;</span> <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">'Тикси'</span>, HH <span class="sc">==</span> <span class="dv">12</span>, Z <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 136 × 10</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="do">##    INDEX name   GGGG    MM    HH     Z    MU    MV    SS wind      </span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;circular&gt;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 21824 Тикси  2007     1    12     0    36    35    48 0.7994817 </span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 21824 Тикси  2007     2    12     0    16    11    27 0.9685090 </span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 21824 Тикси  2007     3    12     0    23    22    34 0.8076167 </span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 21824 Тикси  2007     4    12     0    17     9    30 1.0838971 </span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 21824 Тикси  2007     5    12     0   -17    -3    34 4.5377168 </span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 21824 Тикси  2007     6    12     0   -23   -25    27 3.8853482 </span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 21824 Тикси  2007     7    12     0    -5   -11    27 3.5682201 </span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 21824 Тикси  2007     8    12     0     4     5    25 0.6747409 </span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 21824 Тикси  2007     9    12     0    24    14    34 1.0427219 </span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 21824 Тикси  2007    10    12     0    41    47    40 0.7173217 </span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="do">## # ℹ 126 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Отобразим распределение направлений, розу-диаграмму и плотность распределения. Для построени графиков используем функции <code>plot.circular()</code> и <code>rose.diag</code> из пакета <strong>circular</strong>. Для аппроксимации плотности распределения направлений воспользуемся функцией <code>kern.den.circ()</code> из пакета <strong>NPCirc</strong>. Эта функция использует функцию плотности распределения <em>фон Мизеса</em> в качестве ядра и по умолчанию разбивает круг на 250 направлений, по которым производится оценка плотности (при необходимости это значение можно изменить в параметре <code>len</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.circular</span>(tiksi_wind<span class="sc">$</span>wind, </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.5</span>, </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">stack =</span> <span class="cn">TRUE</span>, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">sep =</span> <span class="fl">0.035</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">axes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">'Среднемноголетняя роза ветров в Тикси'</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">sub =</span> <span class="st">'Измерения за период с 2007 по 2018 г, высота 0 м'</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rose.diag</span>(tiksi_wind<span class="sc">$</span>wind, </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">bins =</span> <span class="dv">8</span>, </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">'gray70'</span>,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">border =</span> <span class="st">'gray30'</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">prop =</span> <span class="dv">1</span>, </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>          <span class="at">add =</span> <span class="cn">TRUE</span>, </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">tick =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd =</span> <span class="fl">0.5</span>)</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>kden <span class="ot">=</span> <span class="fu">kern.den.circ</span>(tiksi_wind<span class="sc">$</span>wind)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(kden, <span class="at">shrink =</span> <span class="dv">3</span>, <span class="co"># параметр shrink отвечает за масштаб радиус-вектора</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">join =</span> F,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">'steelblue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>Параметр <code>shrink</code> отвечает за масштаб радиус-вектора на графиках из пакета <strong>circular</strong>. Чем больше его величина, тем сильнее будет сжат график относительно центра круга.</p>
</blockquote>
<p>Так же как и в случае с обычными данными, плотность распределения удобно использовать для определения модальных направлений, то есть наиболее часто встречающихся. Для этого воспользуемся функцией <code>findpeaks()</code> из пакета <strong>pracma</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>peak <span class="ot">=</span> <span class="fu">findpeaks</span>(kden<span class="sc">$</span>y, <span class="at">sortstr =</span> T)[<span class="dv">1</span>,<span class="dv">2</span>] <span class="co"># находим индекс самого высокого пика плотности распределения</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>(<span class="at">modal =</span> kden<span class="sc">$</span>x[peak]) <span class="co"># извлекаем сам угол</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Circular Data: </span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Type = angles </span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Units = radians </span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Template = geographics </span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Modulo = asis </span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Zero = 1.570796 </span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Rotation = clock </span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.7346777</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a><span class="co"># раскладываем на составляющие для отрисовки линии</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>xp <span class="ot">=</span> <span class="fu">sin</span>(modal)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>yp <span class="ot">=</span> <span class="fu">cos</span>(modal)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.circular</span>(tiksi_wind<span class="sc">$</span>wind, </span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.5</span>, </span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">stack =</span> <span class="cn">TRUE</span>, </span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">sep =</span> <span class="fl">0.035</span>,</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">axes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">'Среднемноголетняя роза ветров в Тикси'</span>,</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">sub =</span> <span class="st">'Измерения за период с 2007 по 2018 г, высота 0 м'</span>)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rose.diag</span>(tiksi_wind<span class="sc">$</span>wind, </span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">bins =</span> <span class="dv">8</span>, </span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="st">'gray70'</span>,</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">border =</span> <span class="st">'gray30'</span>,</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">prop =</span> <span class="dv">1</span>, </span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">add =</span> <span class="cn">TRUE</span>, </span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">tick =</span> <span class="cn">FALSE</span>,</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd =</span> <span class="fl">0.5</span>)</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(kden, <span class="at">shrink =</span> <span class="dv">3</span>, </span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">join =</span> F, <span class="at">col =</span> <span class="st">'steelblue'</span>)</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">0</span>, xp), <span class="fu">c</span>(<span class="dv">0</span>, yp),</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">'orangered'</span>)</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fl">1.4</span> <span class="sc">*</span> xp, <span class="at">y =</span> <span class="fl">1.4</span> <span class="sc">*</span> yp, </span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">'orangered'</span>,</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="dv">180</span> <span class="sc">*</span> modal <span class="sc">/</span> pi, <span class="dv">0</span>), <span class="st">'°'</span>)) <span class="co"># приводим к целым градусам</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Проведем анализ направлений для всех станций. Для этого рассчитаем функции плотности распределения и разместим их в новом фрейме данных с лист-колонкой.</p>
<blockquote class="blockquote">
<p><strong>Лист-колонка</strong> (<em>list-column</em>) позволяет хранить в ячейках таблицы данные произвольного типа. В частности, используя лист-колонку, вы можете хранить в каждой ячейке не один объект, а множество объектов, например записать в нее вектор. Лист-колонка имеет тип <code>list</code>, и каждая ячейка в этой колонке так же, соответственно, имеет тип <code>list</code>. Что (и в каком количестве) располагать внутри ячейки — уже ваше дело. Лист-колонки оказываются неожиданно удобны в самых разнообразных сценариях, в том числе для представления статистических моделей (соответствующих каждой строке таблицы) и для хранения пространственных данных (об этом — в следующей лекции). Вместо хранения этих данных в отдельных переменных вы можете записать их в ячейки.</p>
</blockquote>
<p>В приведенном ниже коде мы группируем все измерения по имени аэрологической обсерватории, вычисляем вектор плотности распределения, записываем его в список, и этот список уже помещается функцией <code>summarise()</code> в <em>единственную</em> ячейку столбца <em>kden</em>, соответствующую данной аэрологической станции. Далее полученная лист-колонка используется для нахождения модальных значений (тут оказывается полезно знание функционалов семейства <code>apply</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">dens =</span> winds <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(HH <span class="sc">==</span> <span class="dv">12</span>, Z <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">kden =</span> <span class="fu">list</span>(<span class="fu">kern.den.circ</span>(wind))) <span class="sc">|&gt;</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">peak =</span> <span class="fu">sapply</span>(kden, <span class="cf">function</span>(X) {</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>                  peak <span class="ot">=</span> <span class="fu">findpeaks</span>(X<span class="sc">$</span>y, <span class="at">sortstr =</span> T)[<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>                  X<span class="sc">$</span>x[peak]</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>                })</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="do">## # A tibble: 13 × 3</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="do">##    name            kden         peak</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;chr&gt;           &lt;list&gt;      &lt;dbl&gt;</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="do">##  1 Верхоянск       &lt;dnsty.cr&gt; -1.77 </span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="do">##  2 Жиганск         &lt;dnsty.cr&gt; -1.50 </span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="do">##  3 Кандалакша      &lt;dnsty.cr&gt; -4.37 </span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="do">##  4 Мирный          &lt;dnsty.cr&gt; -3.78 </span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="do">##  5 Мурманск        &lt;dnsty.cr&gt;  0.772</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="do">##  6 Нарьян-Мар      &lt;dnsty.cr&gt;  0.563</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="do">##  7 Новолазаревская &lt;dnsty.cr&gt; -3.84 </span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="do">##  8 Норильск        &lt;dnsty.cr&gt; -3.85 </span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="do">##  9 Оленек          &lt;dnsty.cr&gt; -1.18 </span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 Остров Диксон   &lt;dnsty.cr&gt; -4.64 </span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 Салехард        &lt;dnsty.cr&gt; -1.90 </span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 Тикси           &lt;dnsty.cr&gt;  0.735</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 13 Шойна           &lt;dnsty.cr&gt;  1.01</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>После этого построим розы-диаграммы для всех станций. В данном случае оправдано использование обычного цикла, т.к. итераций немного:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># устанавливаем параметры компоновки</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># строим графики в цикле</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (obs_name <span class="cf">in</span> dens<span class="sc">$</span>name) {</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  wind_df <span class="ot">=</span> winds <span class="sc">|&gt;</span> <span class="fu">filter</span>(name <span class="sc">==</span> obs_name, HH <span class="sc">==</span> <span class="dv">12</span>, Z <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  dens_df <span class="ot">=</span> dens <span class="sc">|&gt;</span> <span class="fu">filter</span>(name <span class="sc">==</span> obs_name)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  modal <span class="ot">=</span> dens_df<span class="sc">$</span>peak</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  xp <span class="ot">=</span> <span class="fu">sin</span>(modal)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  yp <span class="ot">=</span> <span class="fu">cos</span>(modal)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot.circular</span>(wind_df<span class="sc">$</span>wind, </span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">shrink =</span> <span class="fl">1.2</span>,</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">cex =</span> <span class="fl">0.5</span>, </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">stack =</span> <span class="cn">TRUE</span>, </span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">sep =</span> <span class="fl">0.035</span>,</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">axes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">main =</span> obs_name)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rose.diag</span>(wind_df<span class="sc">$</span>wind, </span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">bins =</span> <span class="dv">8</span>, </span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="st">'gray70'</span>,</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">border =</span> <span class="st">'gray30'</span>,</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">prop =</span> <span class="dv">1</span>, </span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">add =</span> <span class="cn">TRUE</span>, </span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">tick =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">lwd =</span> <span class="fl">0.5</span>)</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(dens_df<span class="sc">$</span>kden[[<span class="dv">1</span>]], </span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">shrink =</span> <span class="dv">3</span>, <span class="at">join=</span>F,</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">'steelblue'</span>)</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(<span class="fu">c</span>(<span class="dv">0</span>, xp), <span class="fu">c</span>(<span class="dv">0</span>, yp),</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">'orangered'</span>)</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(<span class="at">x =</span> <span class="fl">1.4</span> <span class="sc">*</span> xp, <span class="at">y =</span> <span class="fl">1.4</span> <span class="sc">*</span> yp, </span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">'orangered'</span>,</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">labels =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(<span class="dv">180</span> <span class="sc">*</span> modal <span class="sc">/</span> pi, <span class="dv">0</span>), <span class="st">'°'</span>)) <span class="co"># приводим к целым градусам</span></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-35-2.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-35-3.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-35-4.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-35-5.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-35-6.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="13-VectorAnalysis_files/figure-html/unnamed-chunk-35-7.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Таким образом, мы провели графический и статистический анализ среднемноголетних направлений ветра по данным полярных аэрологических станций России. Выявлены модальные направлений, выполнена аппроксимация функции плотности вероятности направлений ветра.</p>
</section>
</section>
<section id="vector_review" class="level2" data-number="13.10">
<h2 data-number="13.10" class="anchored" data-anchor-id="vector_review"><span class="header-section-number">13.10</span> Краткий обзор</h2>
<p>Для просмотра презентации щелкните на ней один раз левой кнопкой мыши и листайте, используя кнопки на клавиатуре:</p>
<div class="cell">
<iframe src="https://tsamsonov.github.io/r-geo-course-slides/13_Vector.html#1" width="100%" height="390px" data-external="1">
</iframe>
</div>
<blockquote class="blockquote">
<p>Презентацию можно открыть в отдельном окне или вкладке браузере. Для этого щелкните по ней правой кнопкой мыши и выберите соответствующую команду.</p>
</blockquote>
</section>
<section id="qtasks_vector_analysis" class="level2" data-number="13.11">
<h2 data-number="13.11" class="anchored" data-anchor-id="qtasks_vector_analysis"><span class="header-section-number">13.11</span> Контрольные вопросы и упражнения</h2>
<section id="questions_vector_analysis" class="level3" data-number="13.11.1">
<h3 data-number="13.11.1" class="anchored" data-anchor-id="questions_vector_analysis"><span class="header-section-number">13.11.1</span> Вопросы</h3>
<ol type="1">
<li>Перечислите три основных вида пространственных отношений, приведите их примеры.</li>
<li>Перечислите 8 вариантов топологических отношений и названий функций <strong>sf</strong>, которые им соответствуют.</li>
<li>Опишите способ, с помощью которого можно выбрать пространственные объекты, пересекающиеся с заданным множеством пространственных объектов.</li>
<li>Каким образом можно заменить тип топологического отношения с пересечения на любой другой при выполнении пространственной выборки?</li>
<li>Чем отличаются контекстные и целевые объекты?</li>
<li>В чем заключается отличие абсолютных и конкурентных зон окружения?</li>
<li>Какая функция пакета sf позволяет вычислять расстояния между объектами? Как с помощью полученного результата определить для каждого объекта из множества <span class="math inline">\(A\)</span> определить ближайший к нему объект из множества <span class="math inline">\(B\)</span>?</li>
<li>Опишите последовательность действий, которую необходимо выполнить для подсчета количества точечных объектов по заданной сетке полигонов.</li>
<li>С помощью какой функции можно построить буферную зону вокруг пространственного объекта? Есть ли ограничения на размерность буферизуемого пространственного объекта (точка, линия, полигон)? Можно ли построить буфер вокруг поверхности?</li>
<li>Какая геометрическая структура используется для построения конкурентных зон окружения?</li>
<li>Что такое OSRM?</li>
<li>Какими средствами можно построить зоны транспортной доступности и маршруты в среде R? В какой системе координат должны быть точки, участвующие в сетевом анализе?</li>
<li>Опишите возможности и основные функции пакета <code>cartography</code>, с помощью которых можно строить тематические карты способами картограмм, картодиаграмм и линейных знаков, а также легенды к ним.</li>
<li>В каком виде направления рассматриваются в круговой статистике?</li>
<li>Какое распределение является аналогом нормального распределения для круговых данных? Что означают параметры <span class="math inline">\(\kappa\)</span> и <span class="math inline">\(\mu\)</span> в функции этого распределения?</li>
<li>Как вычисляется равнодействующий вектор первого порядка и выборочная средняя равнодействующая длина этого вектора для направлений?</li>
<li>Чем аксиальные данные отличаются от круговых данных в общем случае? Какие преобразования осуществляются над такими данными для того чтобы применять к ним стандартные методы циркулярной статистики?</li>
<li>Какой класс данных (и пакет) можно использовать в R для представления направлений? Как указать, что направления отсчитываются географическим методом, то есть, по часовой стрелки от направления на север?</li>
<li>Какую функцию можно использовать для для оценки плотности распределения круговых данных? В каком пакете она находится?</li>
<li>Какую функцию можно использовать для выявления модальных направлений по данным функции плотности вероятности?</li>
<li>Какие функции позволяют строить диаграммы и розы-диаграммы по круговым данным в среде R?</li>
<li>Какой параметр управляет масштабом радиус-вектора на круговых графиках?</li>
<li>Что такое лист-колонка в фрейме данных, и какого типа данные можно в ней хранить?</li>
</ol>
</section>
<section id="tasks_vector_analysis" class="level3" data-number="13.11.2">
<h3 data-number="13.11.2" class="anchored" data-anchor-id="tasks_vector_analysis"><span class="header-section-number">13.11.2</span> Упражнения</h3>
<ol type="1">
<li><p>Проанализируйте пространственную ассоциацию подтипов почв с типами рельефа <a href="https://github.com/tsamsonov/r-geo-course/blob/master/data/Satino.gpkg">данным</a> ГИС Сатино. Для этого выполните оверлей между слоями <em>RelTypes</em> и <em>SoilTypes</em> методом <a href="https://r-spatial.github.io/sf/reference/geos_binary_ops.html"><code>st_intersection()</code></a>. Для каждого подтипа почв рассчитайте долю, которая занята в его площади каждым типом рельефа. Визуализируйте результаты средствами <strong>ggplot2</strong> в виде столбчатой диаграммы, где каждый столбик отвечает за подтип почвы, а его внутреннее разделение соответствует долям типов рельефа. Используя функцию <a href="https://www.rdocumentation.org/packages/rcompanion/versions/2.3.25/topics/cramerV"><code>cramerV()</code></a> из пакета <strong>rcompanion</strong>, рассчитайте <a href="https://en.wikipedia.org/wiki/Cram%C3%A9r%27s_V">коэффициент ассоциации Крамера</a>, чтобы охарактеризовать силу ассоциации между этими номинальными переменными.</p>
<blockquote class="blockquote">
<p><strong>Подсказка</strong>: для вычисления коэффциента Крамера вам необходимо преобразовать данные в широкую форму, где подтипы почв идут по строкам, а типы рельефа — по столбцам. Полученную таблицу необходимо конвертировать в матрицу и подать на вход функции <code>cramerV()</code>.</p>
</blockquote></li>
<li><p>Одна из гипотез, часто используемых в <a href="https://ru.wikipedia.org/wiki/%D0%93%D0%B5%D0%BE%D0%BC%D0%B0%D1%80%D0%BA%D0%B5%D1%82%D0%B8%D0%BD%D0%B3">геомаркетинге</a> — это так называемые <em>аттракторы потоков</em> — пространственные объекты, которые сосредотачивают в своей близости высокую плотность пешеходного трафика. Типичный пример аттрактора — любая транспортная локация: выход из метро, железнодорожная платформа, автобусная остановка. Владельцы предприятий сферы услуг в теории стремятся размещать свои точки вблизи к аттракторам. Используя данные из настоящей лекции, проведите проверку реалистичности этой теории. Для этого:</p>
<ul>
<li>постройте вокруг выходов станций метро несколько буферных зон увеличивающегося радиуса</li>
<li>выберите ими пункты общественного питания</li>
<li>рассчитайте их плотность как отношение количества к площади буфера</li>
</ul>
<p>Далее постройте график зависимости между радиусом буфера и плотностью объектов интереса. Рассчитайте также коэффициент корреляции между этими величинами.</p></li>
<li><p>Субъекты Российской Федерации пронумерованы числами от 1 до 85 в алфавитном порядке. Для решения задач пространственного анализа часто бывает необходимо, чтобы нумерация была пространственная. В этом случае соседние субъекты будут иметь похожие номера. Придумайте методику такой нумерации и реализуйте ее в виде программы на языке R.</p></li>
</ol>
<table class="table">
<tbody>
<tr class="odd">
<td><em>Самсонов Т.Е.</em> <strong>Визуализация и анализ географических данных на языке R.</strong> М.: Географический факультет МГУ, 2023. DOI: <a href="https://doi.org/10.5281/zenodo.901911">10.5281/zenodo.901911</a></td>
</tr>
</tbody>
</table>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-mardia2000directional" class="csl-entry" role="listitem">
Mardia, K V, and P E Jupp. 2000. <em>Directional Statistics</em>. <span>Chichester New York</span>: Wiley.
</div>
<div id="ref-Oliveira2014" class="csl-entry" role="listitem">
Oliveira, Ma’ria, Rosa M. Crujeiras, and Alberto Rod’riguez-Casal. 2014. <span>“<span>NPCirc</span> : <span>An R Package</span> for <span>Nonparametric Circular Methods</span>.”</span> <em>Journal of Statistical Software</em> 61 (9): 1–26. <a href="https://doi.org/10.18637/jss.v061.i09">https://doi.org/10.18637/jss.v061.i09</a>.
</div>
<div id="ref-Oliveira2012" class="csl-entry" role="listitem">
Oliveira, M., R. M. Crujeiras, and A. Rod’riguez-Casal. 2012. <span>“A Plug-in Rule for Bandwidth Selection in Circular Density Estimation.”</span> <em>Computational Statistics and Data Analysis</em> 56 (12): 3898–908. <a href="https://doi.org/10.1016/j.csda.2012.05.021">https://doi.org/10.1016/j.csda.2012.05.021</a>.
</div>
<div id="ref-pewsey2013circular" class="csl-entry" role="listitem">
Pewsey, Arthur, Markus Neuhäuser, and Graeme D. Ruxton. 2013. <em>Circular Statistics in <span>R</span></em>. <span>Oxford New York</span>: <span>Oxford University Press</span>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./12-3DModels.html" class="pagination-link  aria-label=" &lt;span="" модели&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Трехмерные модели</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./14-RasterAnalysis.html" class="pagination-link" aria-label="<span class='chapter-number'>14</span>&nbsp; <span class='chapter-title'>Растровый анализ</span>">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Растровый анализ</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>