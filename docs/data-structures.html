<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Глава 2 Структуры данных | Визуализация и анализ географических данных на языке R</title>
<meta name="author" content="Тимофей Самсонов">
<meta name="description" content="Программный код главы Структура данных — это программная единица, позволяющая хранить и обрабатывать множество однотипных и/или логически связанных данных. Структуры данных также являются типами...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Глава 2 Структуры данных | Визуализация и анализ географических данных на языке R">
<meta property="og:type" content="book">
<meta property="og:description" content="Программный код главы Структура данных — это программная единица, позволяющая хранить и обрабатывать множество однотипных и/или логически связанных данных. Структуры данных также являются типами...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Глава 2 Структуры данных | Визуализация и анализ географических данных на языке R">
<meta name="twitter:site" content="@timofeysamsonov">
<meta name="twitter:description" content="Программный код главы Структура данных — это программная единица, позволяющая хранить и обрабатывать множество однотипных и/или логически связанных данных. Структуры данных также являются типами...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.19/datatables.js"></script><link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script><script src="libs/plotly-binding-4.10.0/plotly.js"></script><script src="libs/typedarray-0.1/typedarray.min.js"></script><link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="default">
<link rel="stylesheet" href="custom.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Визуализация и анализ географических данных на языке R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Введение</a></li>
<li class="book-part">Основы языка R</li>
<li><a class="" href="basics.html"><span class="header-section-number">1</span> Типы данных</a></li>
<li><a class="active" href="data-structures.html"><span class="header-section-number">2</span> Структуры данных</a></li>
<li><a class="" href="tables.html"><span class="header-section-number">3</span> Таблицы</a></li>
<li><a class="" href="controls.html"><span class="header-section-number">4</span> Функции</a></li>
<li class="book-part">Графика и статистика</li>
<li><a class="" href="graphics.html"><span class="header-section-number">5</span> Базовая графика</a></li>
<li><a class="" href="advgraphics.html"><span class="header-section-number">6</span> Продвинутая графика</a></li>
<li><a class="" href="stats.html"><span class="header-section-number">7</span> Основы статистики</a></li>
<li><a class="" href="temporal.html"><span class="header-section-number">8</span> Временные ряды</a></li>
<li class="book-part">Пространственные данные и карты</li>
<li><a class="" href="spatial.html"><span class="header-section-number">9</span> Пространственные данные</a></li>
<li><a class="" href="maps.html"><span class="header-section-number">10</span> Основы картографии</a></li>
<li><a class="" href="mapping.html"><span class="header-section-number">11</span> Тематические карты</a></li>
<li><a class="" href="three.html"><span class="header-section-number">12</span> Трехмерные модели</a></li>
<li class="book-part">Пространственный анализ</li>
<li><a class="" href="vector.html"><span class="header-section-number">13</span> Векторный анализ</a></li>
<li><a class="" href="interp.html"><span class="header-section-number">14</span> Интерполяция геополей</a></li>
<li><a class="" href="raster.html"><span class="header-section-number">15</span> Растровый анализ</a></li>
<li><a class="" href="network.html"><span class="header-section-number">16</span> Анализ сетей и траекторий</a></li>
<li class="book-part">Решение проблем</li>
<li><a class="" href="package-troubles.html"><span class="header-section-number">A</span> Установка пакетов</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/tsamsonov/r-geo-course">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data-structures" class="section level1" number="2">
<h1>
<span class="header-section-number">Глава 2</span> Структуры данных<a class="anchor" aria-label="anchor" href="#data-structures"><i class="fas fa-link"></i></a>
</h1>
<p><a href="https://github.com/tsamsonov/r-geo-course/blob/master/code/02-DataStructures.R">Программный код главы</a></p>
<p>Структура данных — это программная единица, позволяющая хранить и обрабатывать множество однотипных и/или логически связанных данных. Структуры данных также являются типами данных, но не простыми, а составными. Поэтому обычно, когда говорят “тип данных,” подразумевают именно простые типы данных, рассмотренные в предыдущей главе. В <strong>R</strong> общеупотребительны следующие структуры данных: векторы, матрицы, массивы, фреймы данных, списки и факторы. С использованием структур данных тесно связаны циклы — разновидность управляющей конструкции, предназначенная для многократного повторения определенного набора инструкций.</p>
<div id="data_structures_homo" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> Однородные структуры данных<a class="anchor" aria-label="anchor" href="#data_structures_homo"><i class="fas fa-link"></i></a>
</h2>
<div id="vectors" class="section level3" number="2.1.1">
<h3>
<span class="header-section-number">2.1.1</span> Векторы<a class="anchor" aria-label="anchor" href="#vectors"><i class="fas fa-link"></i></a>
</h3>
<p>Вектор представляет собой упорядоченную последовательность объектов одного типа. Вектор может состоять <em>только</em> из чисел, <em>только</em> из строк, <em>только</em> из дат или <em>только</em> из логических значений и т.д. Числовой вектор легко представить себе в виде набора цифр, выстроенных в ряд и пронумерованных согласно порядку их расстановки.</p>
<p>Вектор является простейшей и одновременно базовой структурой данных в <strong>R</strong>. Понимание принципов работы с векторами необходимо для дальнейшего знакомства с более сложными структурами данных, такими как матрицы, массивы, фреймы данных, тибблы, списки и факторы.</p>
<div id="vector_creation" class="section level4" number="2.1.1.1">
<h4>
<span class="header-section-number">2.1.1.1</span> Создание<a class="anchor" aria-label="anchor" href="#vector_creation"><i class="fas fa-link"></i></a>
</h4>
<p>Существует множество способов создания векторов. Среди них наиболее употребительны:</p>
<ol style="list-style-type: decimal">
<li>Явное перечисление элементов</li>
<li>Создание пустого вектора (“болванки”), состоящего из заданного числа элементов</li>
<li>Генерация последовательности значений</li>
<li>Генерация случайного множества значений</li>
</ol>
<p>Для создания вектора путем <strong>перечисления</strong> элементов используется функция <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>:</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># вектор из строк — цвета некоторых веток Московского метро</span>
<span class="va">colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Красная"</span>, <span class="st">"Зеленая"</span>, <span class="st">"Синяя"</span>, <span class="st">"Коричневая"</span>, <span class="st">"Оранжевая"</span><span class="op">)</span>
<span class="va">colors</span>
<span class="co">## [1] "Красная"    "Зеленая"    "Синяя"      "Коричневая" "Оранжевая"</span></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># вектор из чисел — длина веток в километрах (в той же последовательности)</span>
<span class="va">lengths</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">40</span>, <span class="fl">45</span>, <span class="fl">19</span>, <span class="fl">38</span><span class="op">)</span>
<span class="va">lengths</span>
<span class="co">## [1] 28 40 45 19 38</span></code></pre></div>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># вектор из булевых переменных — наличие  открытых наземных участков (в той же последовательности)</span>
<span class="va">opens</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">opens</span>
<span class="co">## [1] FALSE  TRUE  TRUE FALSE FALSE</span></code></pre></div>
<blockquote>
<p>Внимание: не используйте латинскую букву ‘c’ в качестве названия переменной! Это приведет к конфликту названия встроенной функции c() и определенной вами переменной</p>
</blockquote>
<p>Помимо этого, распространены сценарии, когда вам нужно создать вектор, но заполнять его значениями вы будете по ходу выполнения программы — скажем, при последовательной обработке строк таблицы. В этом случае вам известно только предполагаемое количество элементов вектора и их тип. Здесь лучше всего подойдет <strong>создание пустого вектора</strong>, которое выполняется функцией <code><a href="https://rdrr.io/r/base/vector.html">vector()</a></code>. Функция принимает 2 параметра:</p>
<ul>
<li>
<code>mode</code> отвечает за тип данных и может принимать значения равные <code>"logical"</code>, <code>"integer"</code>, <code>"numeric"</code> (или <code>"double"</code>), <code>"complex"</code>, <code>"character"</code> и <code>"raw"</code>
</li>
<li>
<code>length</code> отвечает за количество элементов</li>
</ul>
<p>Например:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Вектор из 5 элементов, который предполагается заполнить целыми числами</span>
<span class="va">intvalues</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"integer"</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">intvalues</span> <span class="co"># по умолчанию заполнен нулями</span>
<span class="co">## [1] 0 0 0 0 0</span>

<span class="co"># Вектор из 10 элементов, который предполагается заполнить символьными данными (строками)</span>
<span class="va">charvalues</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">"character"</span>, <span class="fl">10</span><span class="op">)</span>
<span class="va">charvalues</span> <span class="co"># по умолчанию заполнен пустыми строками</span>
<span class="co">##  [1] "" "" "" "" "" "" "" "" "" ""</span></code></pre></div>
<p>Обратите внимание на то, что в первом случае подстановка параметров произведена в виде <code>параметр = значение</code>, а во втором указаны только значения. В данном примере оба способа эквивалентны. Однако первый способ безопаснее и понятнее. Если вы указываете только значения параметров, нужно помнить, что интерпретатор будет подставлять их именно в том порядке, в котором они перечислены в описании функции.</p>
<blockquote>
<p>Описание функции можно посмотреть, набрав ее название в консоли ее название со знаком вопроса в качестве префикса. Например, для вышеуказанной функции надо набрать <code><a href="https://rdrr.io/r/base/vector.html">?vector</a></code></p>
</blockquote>
<p>Наконец, третий распространенный способ создания векторов — это <strong>генерация последовательности</strong>. Чтобы сформировать вектор из натуральных чисел от <code>M</code> до <code>N</code>, можно воспользоваться специальной конструкцией: <code>M:N</code>:</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">index</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span> <span class="co"># эквивалентно c(1,2,3,4,5)</span>
<span class="va">index</span>
<span class="co">## [1] 1 2 3 4 5</span>
<span class="va">index</span> <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span> <span class="co"># эквивалентно c(2,3,4)</span>
<span class="va">index</span>
<span class="co">## [1] 2 3 4</span></code></pre></div>
<p>Существует и более общий способ создания последовательности — функция <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code>, которая позволяет генерировать вектора значений нужной длины и/или с нужным шагом:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">2</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># 10 нечетных чисел, начиная с единицы</span>
<span class="co">##  [1]  1  3  5  7  9 11 13 15 17 19</span>
<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">2</span>, to <span class="op">=</span> <span class="fl">20</span>, by <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="co"># от 2 до 20 с шагом 3 (сколько поместится)</span>
<span class="co">## [1]  2  5  8 11 14 17 20</span>
<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>length.out <span class="op">=</span> <span class="fl">10</span>, to <span class="op">=</span> <span class="fl">2</span>, by <span class="op">=</span> <span class="op">-</span><span class="fl">2</span><span class="op">)</span> <span class="co"># убывающая последовательность из 10 четных чисел с последним элементом, равным 2</span>
<span class="co">##  [1] 20 18 16 14 12 10  8  6  4  2</span></code></pre></div>
<p>Как видно, параметры функции <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> можно комбинировать различными способами и указывать в произвольном порядке (при условии, что вы используете полную форму (<code>параметр = значение</code>). Главное, чтобы их совокупность <em>однозначно описывала последовательность</em>. Хотя, скажем, последний пример убывающей последовательности нельзя признать удачным с точки зрения наглядности.</p>
<p>Аналогичным образом можно создавать <em>последовательности дат</em>:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="st">'2016/09/01'</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">7</span><span class="op">)</span> <span class="co"># Даты первой недели учебного 2016/2017 года</span>
<span class="co">## [1] "2016-09-01" "2016-09-02" "2016-09-03" "2016-09-04" "2016-09-05"</span>
<span class="co">## [6] "2016-09-06" "2016-09-07"</span>

<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># Пять дат через неделю, начиная с сегодняшнего дня</span>
<span class="co">## [1] "2021-10-25" "2021-11-01" "2021-11-08" "2021-11-15" "2021-11-22"</span></code></pre></div>
<p>Часто оказывается полезным такая функция как генерация множества случайных значений, подчиненных определенному закону распределения. Наиболее часто испольщуются функции <code><a href="https://rdrr.io/r/stats/Uniform.html">runif()</a></code> (равномерное распределение) и <code><a href="https://rdrr.io/r/stats/Normal.html">rnorm()</a></code> (нормальное распределение):</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span> <span class="co"># 5 чисел равномерного распределения в диапазоне от 0 до 100</span>
<span class="co">## [1] 91.27477 99.44831 41.24710 26.79807 92.87631</span>
<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span> <span class="co"># 5 чисел нормального распределения со средним = 10 и СКО = 5</span>
<span class="co">## [1] 12.470573 12.887909 14.099029 13.781805  7.004208</span></code></pre></div>
</div>
<div id="vector_indexing" class="section level4" number="2.1.1.2">
<h4>
<span class="header-section-number">2.1.1.2</span> Индексирование<a class="anchor" aria-label="anchor" href="#vector_indexing"><i class="fas fa-link"></i></a>
</h4>
<p>К отдельным <strong>элементам вектора</strong> можно обращаться по их индексам:</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">colors</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co"># первый элемент вектора</span>
<span class="co">## [1] "Красная"</span>
<span class="va">colors</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="co"># третий элемент</span>
<span class="co">## [1] "Синяя"</span></code></pre></div>
<blockquote>
<p>ВНИМАНИЕ: элементы векторов и других структур данных в языке R индексируются от 1 до N, где N — это длина вектора. Это отличает R от широко распространенных Си-подобных языков программирования (C, C++, C#, Java, Python), в которых индексы элементов начинаются с 0 и заканчиваются N-1. Например, первый элемент списка (аналог вектора в R) на языке Python извлекался бы как colors[0]. Будьте внимательны, особенно если программируете на нескольких языках.</p>
</blockquote>
<p><strong>Количество элементов (длину) вектора</strong> можно узнать с помощью функции <code><a href="https://rdrr.io/r/base/length.html">length()</a></code>:</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">colors</span><span class="op">)</span>
<span class="co">## [1] 5</span></code></pre></div>
<p>Последний элемент вектора можно извлечь, если мы знаем его длину:</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">colors</span><span class="op">)</span>
<span class="va">colors</span><span class="op">[</span><span class="va">n</span><span class="op">]</span>
<span class="co">## [1] "Оранжевая"</span></code></pre></div>
<p>Последовательности удобно использовать для извлечения подвекторов. Предположим, нужно извлечь первые 4 элемента. Для этого запишем:</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lengths</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>
<span class="co">## [1] 28 40 45 19</span></code></pre></div>
<p>Индексирующий вектор можно создать заранее. Это удобно, если номера могут меняться в программе:</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">=</span> <span class="fl">1</span>
<span class="va">n</span> <span class="op">=</span> <span class="fl">4</span>
<span class="va">index</span> <span class="op">=</span> <span class="va">m</span><span class="op">:</span><span class="va">n</span>
<span class="va">lengths</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>
<span class="co">## [1] 28 40 45 19</span></code></pre></div>
<p>Обратите внимание на то что по сути один вектор используется для извлечения элементов из другого вектора. Это означает, что мы можем использовать не только простые последовательности натуральных чисел, но и векторы из прозвольных индексов. Например:</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">index</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span> <span class="co"># хотим извлечь 1, 3 и 4 элемент списка</span>
<span class="va">lengths</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>
<span class="co">## [1] 28 45 19</span>

<span class="va">index</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span> <span class="co"># индексы могут располагаться в произвольном порядке</span>
<span class="va">lengths</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>
<span class="co">## [1] 38 28 19 40</span></code></pre></div>
</div>
<div id="vector_transform" class="section level4" number="2.1.1.3">
<h4>
<span class="header-section-number">2.1.1.3</span> Преобразование<a class="anchor" aria-label="anchor" href="#vector_transform"><i class="fas fa-link"></i></a>
</h4>
<p>К числовым векторам можно применять множество функций. Прежде всего, нужно знать функции вычисления базовых параметров статистического ряда — минимум, максимум, среднее, медиана, дисперсия, размах вариации, среднеквадратическое отклонение, сумма:</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span> <span class="co"># минимум</span>
<span class="co">## [1] 19</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span> <span class="co"># максимум</span>
<span class="co">## [1] 45</span>
<span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span> <span class="co"># размах вариации = максимум - минимум</span>
<span class="co">## [1] 19 45</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span> <span class="co"># среднее арифметическое</span>
<span class="co">## [1] 34</span>
<span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span> <span class="co"># медиана</span>
<span class="co">## [1] 38</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span> <span class="co"># дисперсия (по английски - вариация, variation)</span>
<span class="co">## [1] 108.5</span>
<span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span> <span class="co"># среднеквадратическое отклонение (standard deviation)</span>
<span class="co">## [1] 10.41633</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span> <span class="co"># сумма</span>
<span class="co">## [1] 170</span></code></pre></div>
<p>Одной из мощнейших особенностей <strong>R</strong> является то что он не проводит различий между числами и векторами чисел. Поскольку R является матричным языком, каждое число представляется как вектор длиной 1 (или матрица <span class="math inline">\(1х1\)</span>). Это означает, что любая математическая функция, применимая к числу, будет применима и к вектору:</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lengths</span> <span class="op">*</span> <span class="fl">1000</span> <span class="co"># преобразуем длины линий в метры</span>
<span class="co">## [1] 28000 40000 45000 19000 38000</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span> <span class="co"># квадратный корень из длины каждого элемента</span>
<span class="co">## [1] 5.291503 6.324555 6.708204 4.358899 6.164414</span>

<span class="va">stations</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">21</span>, <span class="fl">22</span>, <span class="fl">12</span>, <span class="fl">24</span><span class="op">)</span> <span class="co"># количество станций</span>

<span class="va">dens</span> <span class="op">=</span> <span class="va">stations</span> <span class="op">/</span> <span class="va">lengths</span> <span class="co"># плотность станций по веткам метро = кол-во станций / длина </span>
<span class="va">dens</span>
<span class="co">## [1] 0.7142857 0.5250000 0.4888889 0.6315789 0.6315789</span></code></pre></div>
</div>
<div id="vector_search_sorting" class="section level4" number="2.1.1.4">
<h4>
<span class="header-section-number">2.1.1.4</span> Поиск и сортировка<a class="anchor" aria-label="anchor" href="#vector_search_sorting"><i class="fas fa-link"></i></a>
</h4>
<p>К важнейшим преобразованиям векторов относится их <strong>сортировка</strong>:</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lengths2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span> <span class="co"># сортировка по возрастанию значений</span>
<span class="va">lengths2</span> <span class="co"># отсортированный вектор</span>
<span class="co">## [1] 19 28 38 40 45</span>
<span class="va">lengths</span> <span class="co"># сравним с исходным</span>
<span class="co">## [1] 28 40 45 19 38</span>

<span class="va">lengths2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">lengths</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># сортировка по убыванию значений. Нужно задать параметр decreasing</span>
<span class="va">lengths2</span> <span class="co"># отсортированный вектор</span>
<span class="co">## [1] 45 40 38 28 19</span>
<span class="va">lengths</span> <span class="co"># сравним с исходным</span>
<span class="co">## [1] 28 40 45 19 38</span></code></pre></div>
<p>Другая распространенная задача — это <strong>поиск индекса</strong> элемента по его значению. Например, вы хотите узнать, какая ветка Московского метро (среди рассматриваемых) является самой длинной. Вы, конечно, легко найдете ее длину с помощью функции <code><a href="https://rdrr.io/r/base/Extremes.html">max(lengths)</a></code>. Однако это не поможет вам узнать ее название, поскольку оно находится в другом векторе, и его индекс в массиве неизвестен. Поскольку векторы упорядочены одинаково, нам достаточно узнать, под каким индексом в массиве <code>lengths</code> располагается максимальный элемент, и затем извлечь цвет линии метро под тем же самым индексом. Дл поиска индекса элемента используется функция <code><a href="https://rdrr.io/r/base/match.html">match()</a></code>:</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">l</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span> <span class="co"># находим максимальное значение</span>
<span class="va">idx</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">l</span>, <span class="va">lengths</span><span class="op">)</span> <span class="co"># находим индекс элемента, равного l, в списке lengths</span>
<span class="va">color</span> <span class="op">=</span> <span class="va">colors</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span> <span class="co"># извлекаем цвет ветки метро</span>
<span class="va">color</span>
<span class="co">## [1] "Синяя"</span></code></pre></div>
<p>Здесь непохо бы лишний раз потренироваться в конкатенации строк, чтобы вывести результат красиво!</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">s</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">color</span>, <span class="st">"ветка Московского метро — самая длинная. Ее протяженность составляет"</span>, <span class="va">l</span>, <span class="st">"км"</span><span class="op">)</span>
<span class="va">s</span>
<span class="co">## [1] "Синяя ветка Московского метро — самая длинная. Ее протяженность составляет 45 км"</span></code></pre></div>
<p>Ну и напоследок пример “матрешки”” из функций — как найти название самой плотной линии одним выражением:</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">colors</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dens</span><span class="op">)</span>,<span class="va">dens</span><span class="op">)</span><span class="op">]</span>
<span class="co">## [1] "Красная"</span></code></pre></div>
</div>
<div id="vector_conditions" class="section level4" number="2.1.1.5">
<h4>
<span class="header-section-number">2.1.1.5</span> Проверка условий<a class="anchor" aria-label="anchor" href="#vector_conditions"><i class="fas fa-link"></i></a>
</h4>
<p>Проверка условия для вектора приводит к получению вектора логических значений:</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lengths</span> <span class="op">&gt;</span> <span class="fl">20</span>
<span class="co">## [1]  TRUE  TRUE  TRUE FALSE  TRUE</span></code></pre></div>
<p>Такого рода условия используются для фильтрации фреймов данных (см. далее)</p>
<p>Для векторов существует специальная форма векторизованного условного оператора – функция <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code>. Она позволяет создать вектор, каждый элемент которого вычисляется по-разному в зависимости от значения элемента другого вектора в соответствующей позиции. Например, мы можем охарактеризовать каждую линию метро как длинную или короткую, установив порог в 20 км:</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">line_type</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">lengths</span> <span class="op">&gt;</span> <span class="fl">20</span>, <span class="st">'Длинная'</span>, <span class="st">'Короткая'</span><span class="op">)</span><span class="op">)</span>
<span class="co">## [1] "Длинная"  "Длинная"  "Длинная"  "Короткая" "Длинная"</span></code></pre></div>
</div>
<div id="vector_summaries" class="section level4" number="2.1.1.6">
<h4>
<span class="header-section-number">2.1.1.6</span> Описательные статистики<a class="anchor" aria-label="anchor" href="#vector_summaries"><i class="fas fa-link"></i></a>
</h4>
<p>Можно получить краткую статистическую сводку по вектору (и любой другой структуре данных) с использованием функции <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>. Для качественных переменных выдаются частоты вхождения каждого случая, для количественных — набор основных описательных статистик:</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span>
<span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">##      19      28      38      34      40      45</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">opens</span><span class="op">)</span>
<span class="co">##    Mode   FALSE    TRUE </span>
<span class="co">## logical       3       2</span></code></pre></div>
</div>
</div>
<div id="matrices" class="section level3" number="2.1.2">
<h3>
<span class="header-section-number">2.1.2</span> Матрицы<a class="anchor" aria-label="anchor" href="#matrices"><i class="fas fa-link"></i></a>
</h3>
<p>Матрица — это обобщение понятия вектора на 2 измерения. С точки зрения анализа данных матрицы ближе к реальным данным, посколько каждая матрица по сути представляет собой таблицу со столбцами и строками. Однако матрица, как и вектор, может содержать только элементы одного типа (числовые, строковые, логические и т.д.). Позже мы познакомимся с фреймами данных, которые не обладают подобным ограничением.</p>
<p>Матрица, как правило, создается с помощью функции <code>matrix</code>, которая принимает 3 обязательных аргумента: вектор исходных значений, количество строк и количество столбцов:</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">v</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>  <span class="co"># создадим вектор из натуральных чисел от 1 до 12</span>
<span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">v</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="va">m</span>
<span class="co">##      [,1] [,2] [,3] [,4]</span>
<span class="co">## [1,]    1    4    7   10</span>
<span class="co">## [2,]    2    5    8   11</span>
<span class="co">## [3,]    3    6    9   12</span></code></pre></div>
<p>По умолчанию матрица заполняется данными вектора по столбцам, что можно видеть в выводе программы. Если вы хотите заполнить ее по строкам, необходимо указать параметр <code>byrow = TRUE</code>:</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">v</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">m</span>
<span class="co">##      [,1] [,2] [,3] [,4]</span>
<span class="co">## [1,]    1    2    3    4</span>
<span class="co">## [2,]    5    6    7    8</span>
<span class="co">## [3,]    9   10   11   12</span></code></pre></div>
<p>Доступ к элементам матрицы осуществляется аналогично вектору, за исключением того что нужно указать положение ячейки в строке и столбце:</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">4</span><span class="op">]</span>  <span class="co"># 2 строка, 4 толбец</span>
<span class="co">## [1] 8</span>
<span class="va">m</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">]</span>  <span class="co"># 3 строка, 1 столбец</span>
<span class="co">## [1] 9</span></code></pre></div>
<p>Помимо этого, из матрицы можно легко извлечь одну строку или один столбец. Для этого достаточно указать только номер строки или столбца, а номер второго измерения пропустить до или после запятой. Результат является вектором:</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span><span class="op">[</span><span class="fl">2</span>,<span class="op">]</span>  <span class="co"># 2 строка</span>
<span class="co">## [1] 5 6 7 8</span>
<span class="va">m</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>  <span class="co"># 3 cтолбец</span>
<span class="co">## [1]  3  7 11</span></code></pre></div>
<p>К матрицам можно применять операции, аналогичные операциям над векторами:</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>  <span class="co"># натуральный логарифм ото всех элементов</span>
<span class="co">##          [,1]      [,2]     [,3]     [,4]</span>
<span class="co">## [1,] 0.000000 0.6931472 1.098612 1.386294</span>
<span class="co">## [2,] 1.609438 1.7917595 1.945910 2.079442</span>
<span class="co">## [3,] 2.197225 2.3025851 2.397895 2.484907</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>  <span class="co"># сумма всех элементов матрицы</span>
<span class="co">## [1] 78</span>
<span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span> <span class="co"># медиана</span>
<span class="co">## [1] 6.5</span></code></pre></div>
<p>B и получать по ним описательные статистики:</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>
<span class="co">##        V1          V2           V3           V4    </span>
<span class="co">##  Min.   :1   Min.   : 2   Min.   : 3   Min.   : 4  </span>
<span class="co">##  1st Qu.:3   1st Qu.: 4   1st Qu.: 5   1st Qu.: 6  </span>
<span class="co">##  Median :5   Median : 6   Median : 7   Median : 8  </span>
<span class="co">##  Mean   :5   Mean   : 6   Mean   : 7   Mean   : 8  </span>
<span class="co">##  3rd Qu.:7   3rd Qu.: 8   3rd Qu.: 9   3rd Qu.:10  </span>
<span class="co">##  Max.   :9   Max.   :10   Max.   :11   Max.   :12</span></code></pre></div>
<p>А вот сортировка матрицы приведет к тому что будет возвращен обычный вектор:</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>
<span class="co">##  [1]  1  2  3  4  5  6  7  8  9 10 11 12</span></code></pre></div>
<p>К матрицам также применимы специальные функции, известные из линейной алгебры, такие как транспонирование и вычисление определителя:</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>  <span class="co"># транспонированная матрица</span>
<span class="co">##      [,1] [,2] [,3]</span>
<span class="co">## [1,]    1    5    9</span>
<span class="co">## [2,]    2    6   10</span>
<span class="co">## [3,]    3    7   11</span>
<span class="co">## [4,]    4    8   12</span>
<span class="va">m2</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span><span class="op">:</span><span class="fl">3</span>,nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">m2</span>
<span class="co">##      [,1] [,2] [,3]</span>
<span class="co">## [1,]   -3    0    3</span>
<span class="co">## [2,]   -2    1   -3</span>
<span class="co">## [3,]   -1    2   -2</span>
<span class="fu"><a href="https://rdrr.io/r/base/det.html">det</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span> <span class="co"># определитель матрицы</span>
<span class="co">## [1] -21</span>
<span class="fu"><a href="https://rdrr.io/r/base/det.html">det</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span>  <span class="co"># ошибка! определитель вычисляется только для квадратных матриц</span>
<span class="co">## Error in determinant.matrix(x, logarithm = TRUE, ...): 'x' должен быть квадратной матрицей</span></code></pre></div>
<p>Матрицы также можно перемножать с помощью специального оператора <code><a href="https://rdrr.io/r/base/matmult.html">%*%</a></code>. При этом, как мы помним, число столбцов в первой матрице должно равняться числу строк во второй:</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m2</span> <span class="op">%*%</span> <span class="va">m</span>
<span class="co">##      [,1] [,2] [,3] [,4]</span>
<span class="co">## [1,]   24   24   24   24</span>
<span class="co">## [2,]  -24  -28  -32  -36</span>
<span class="co">## [3,]   -9  -10  -11  -12</span>
<span class="va">m</span> <span class="op">%*%</span> <span class="va">m2</span>  <span class="co"># ошибка!</span>
<span class="co">## Error in m %*% m2: неподобные аргументы</span></code></pre></div>
<p>Функция <code><a href="https://rdrr.io/r/base/match.html">match()</a></code>, которую мы использовали для поиска элементов в векторе, не работает для матриц. Вместо этого необходимо использовать функцию <code><a href="https://rdrr.io/r/base/which.html">which()</a></code>. Если мы хотим найти в матрице m позицию числа <span class="math inline">\(8\)</span>, то вызов функции будет выглядеть так:</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fl">8</span>, arr.ind <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">##      row col</span>
<span class="co">## [1,]   2   4</span></code></pre></div>
<p>В данном случае видно, что результат возвращен в виде матрицы <span class="math inline">\(1 \times 2\)</span>. Обратите внимание на то, что колонки матрицы имеют названия. Попробуем использовать найденные индексы, чтобы извлечь искомый элемент:</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">indexes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">m</span> <span class="op">==</span> <span class="fl">8</span>, arr.ind <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">row</span> <span class="op">=</span> <span class="va">indexes</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>
<span class="va">col</span> <span class="op">=</span> <span class="va">indexes</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>
<span class="va">m</span><span class="op">[</span><span class="va">row</span>,<span class="va">col</span><span class="op">]</span>
<span class="co">## [1] 8</span></code></pre></div>
<p>Ура! Найденный элемент действительно равен <span class="math inline">\(8\)</span>.</p>
<p>Еще один полезный способ создания матрицы — это собрать ее из нескольких векторов, объединив их по строкам. Для этого можно использовать функции <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code> и <code><a href="https://rdrr.io/r/base/cbind.html">rbind()</a></code>. На предыдущем занятии мы создали векторы с длиной и количеством станций на разных ветках метро. Можно объединить их в одну матрицу:</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lengths</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">40</span>, <span class="fl">45</span>, <span class="fl">19</span>, <span class="fl">38</span><span class="op">)</span>
<span class="va">stations</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">21</span>, <span class="fl">22</span>, <span class="fl">12</span>, <span class="fl">24</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">lengths</span>, <span class="va">stations</span><span class="op">)</span>  <span class="co"># соединим вектора в качестве столбцов</span>
<span class="co">##      lengths stations</span>
<span class="co">## [1,]      28       20</span>
<span class="co">## [2,]      40       21</span>
<span class="co">## [3,]      45       22</span>
<span class="co">## [4,]      19       12</span>
<span class="co">## [5,]      38       24</span>
<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">lengths</span>, <span class="va">stations</span><span class="op">)</span>  <span class="co"># соединим вектора в качестве строк</span>
<span class="co">##          [,1] [,2] [,3] [,4] [,5]</span>
<span class="co">## lengths    28   40   45   19   38</span>
<span class="co">## stations   20   21   22   12   24</span></code></pre></div>
<p>Cтроки и столбцы матрицы можно использовать как векторы при выполнении арифметических операций:</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">lengths</span>, <span class="va">stations</span><span class="op">)</span>
<span class="va">mm</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">mm</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>  <span class="co"># количество станций на 1 км пути</span>
<span class="co">## [1] 0.7142857 0.5250000 0.4888889 0.6315789 0.6315789</span></code></pre></div>
<p>Результат можно присоединить к уже созданной матрице:</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dens</span> <span class="op">=</span> <span class="va">mm</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">mm</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
<span class="va">mm</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">mm</span>, <span class="va">dens</span><span class="op">)</span>
<span class="va">mm</span>
<span class="co">##      lengths stations      dens</span>
<span class="co">## [1,]      28       20 0.7142857</span>
<span class="co">## [2,]      40       21 0.5250000</span>
<span class="co">## [3,]      45       22 0.4888889</span>
<span class="co">## [4,]      19       12 0.6315789</span>
<span class="co">## [5,]      38       24 0.6315789</span></code></pre></div>
<p>Содержимое матрицы можно просмотреть в более привычном табличном виде для этого откройте вкладку <em>Environment</em> и щелкните на строку с матрицей в разделе <em>Data</em></p>
<p>Матрицы, однако, не дотягивают по функциональности до представления таблиц, и не предназначены для объединения разнородных данных в один набор (как мы это сделали). Если вы присоедините к матрице столбец с названиями веток метро, система не выдаст сообщение об ошибке, но преобразует матрицу в текстовую, так как текстовый тип данных способен представить любой другой тип данных:</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">colors</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Красная"</span>, <span class="st">"Зеленая"</span>, <span class="st">"Синяя"</span>, <span class="st">"Коричневая"</span>, <span class="st">"Оранжевая"</span><span class="op">)</span>
<span class="va">mm2</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">mm</span>,<span class="va">colors</span><span class="op">)</span>
<span class="va">mm2</span>  <span class="co"># обратите внимание на то, что вокруг чисел добавились кавычки</span>
<span class="co">##      lengths stations dens                colors      </span>
<span class="co">## [1,] "28"    "20"     "0.714285714285714" "Красная"   </span>
<span class="co">## [2,] "40"    "21"     "0.525"             "Зеленая"   </span>
<span class="co">## [3,] "45"    "22"     "0.488888888888889" "Синяя"     </span>
<span class="co">## [4,] "19"    "12"     "0.631578947368421" "Коричневая"</span>
<span class="co">## [5,] "38"    "24"     "0.631578947368421" "Оранжевая"</span></code></pre></div>
<p>При попытке выполнить арифметическое выражение над прежде числовыми полями, вы получите сообщение об ошибке:</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mm2</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">mm2</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>
<span class="co">## Error in mm2[, 2]/mm2[, 1]: нечисловой аргумент для бинарного оператора</span></code></pre></div>
</div>
<div id="arrays" class="section level3" number="2.1.3">
<h3>
<span class="header-section-number">2.1.3</span> Массивы<a class="anchor" aria-label="anchor" href="#arrays"><i class="fas fa-link"></i></a>
</h3>
<p><em>Массивы (arrays)</em> — это многомерные структуры данных, с колчеством измерений 3 и более. Трехмерный массив представляет собой куб однородных данных. Для создания массива используется функция <code><a href="https://rdrr.io/r/base/array.html">array()</a></code>:</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">36</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># вектор значений для заполнения массива, а также длина каждого измерения</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>
<span class="co">## , , 1</span>
<span class="co">## </span>
<span class="co">##      [,1] [,2] [,3] [,4]</span>
<span class="co">## [1,]    1    4    7   10</span>
<span class="co">## [2,]    2    5    8   11</span>
<span class="co">## [3,]    3    6    9   12</span>
<span class="co">## </span>
<span class="co">## , , 2</span>
<span class="co">## </span>
<span class="co">##      [,1] [,2] [,3] [,4]</span>
<span class="co">## [1,]   13   16   19   22</span>
<span class="co">## [2,]   14   17   20   23</span>
<span class="co">## [3,]   15   18   21   24</span></code></pre></div>
<p>Массивы возникают тогда, например, когда имеются многомерные данные, зафиксированные по регулярной сетке географичесих локаций (это типично для геофизических данных). При этом 2 измерения отвечают за местоположение, а третье измерение — за временной срез или показатель.</p>
</div>
</div>
<div id="heterogeneous" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> Разнородные структуры данных<a class="anchor" aria-label="anchor" href="#heterogeneous"><i class="fas fa-link"></i></a>
</h2>
<div id="data_frames" class="section level3" number="2.2.1">
<h3>
<span class="header-section-number">2.2.1</span> Фреймы данных<a class="anchor" aria-label="anchor" href="#data_frames"><i class="fas fa-link"></i></a>
</h3>
<p><em>Фреймы данных</em> — это обобщение понятия матрицы на данные смешанных типов. Фреймы данных - наиболее распространенный формат представления табличных данных. Для краткости мы иногда будем называть их просто фреймами.</p>
<blockquote>
<p>Мы специально не используем для перевода слова <code>data.frame</code> термин ‘таблица,’ поскольку таблица — это достаточно общая категория, которая описывает концептуальный способ упорядочивания данных. В том же языке R для представления таблиц могут быть использованы как минимум две структуры данных: фрейм данных (data.frame) и тиббл (tibble), доступный в соответствующем <a href="https://cran.r-project.org/web/packages/tibble/index.html">пакете</a>. Мы не будем использовать тибблы в настоящем курсе, но после его освоения вы вполне сможете ознакомиться с ними самостоятельною</p>
</blockquote>
<p>Для создания фреймов данных используется функция <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code>:</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">colors</span>,<span class="va">lengths</span>,<span class="va">stations</span><span class="op">)</span>
<span class="va">df</span>  <span class="co"># как мы видим, уже никаких кавычек вокруг чисел</span>
<span class="co">##       colors lengths stations</span>
<span class="co">## 1    Красная      28       20</span>
<span class="co">## 2    Зеленая      40       21</span>
<span class="co">## 3      Синяя      45       22</span>
<span class="co">## 4 Коричневая      19       12</span>
<span class="co">## 5  Оранжевая      38       24</span></code></pre></div>
<p>К фреймам также можно пристыковывать новые столбцы:</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">dens</span><span class="op">)</span>
<span class="va">df</span>
<span class="co">##       colors lengths stations      dens</span>
<span class="co">## 1    Красная      28       20 0.7142857</span>
<span class="co">## 2    Зеленая      40       21 0.5250000</span>
<span class="co">## 3      Синяя      45       22 0.4888889</span>
<span class="co">## 4 Коричневая      19       12 0.6315789</span>
<span class="co">## 5  Оранжевая      38       24 0.6315789</span></code></pre></div>
<p>Когда фрейм данных формируется посредством функции <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code> и <code><a href="https://rdrr.io/r/base/cbind.html">cbind()</a></code>, названия столбцов берутся из названий векторов. Обратите внимание на то, что листинге выше столбцы имеют заголовки, а строки — номера.</p>
<p>Как и прежде, к столбцам и строкам можно обращаться по индексам:</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>
<span class="co">## [1] 40</span>
<span class="va">df</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>
<span class="co">## [1] 20 21 22 12 24</span>
<span class="va">df</span><span class="op">[</span><span class="fl">4</span>,<span class="op">]</span>
<span class="co">##       colors lengths stations      dens</span>
<span class="co">## 4 Коричневая      19       12 0.6315789</span></code></pre></div>
<p>Вы можете обращаться к отдельным столбцам фрейма данных по их названию, используя оператор <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> (доллар):</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">$</span><span class="va">lengths</span>
<span class="co">## [1] 28 40 45 19 38</span>
<span class="va">df</span><span class="op">$</span><span class="va">stations</span>
<span class="co">## [1] 20 21 22 12 24</span></code></pre></div>
<p>Так же как и ранее, можно выполнять различные операции над столбцами:</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">stations</span><span class="op">)</span>
<span class="co">## [1] 24</span>
<span class="va">df</span><span class="op">$</span><span class="va">lengths</span> <span class="op">/</span> <span class="va">df</span><span class="op">$</span><span class="va">stations</span>
<span class="co">## [1] 1.400000 1.904762 2.045455 1.583333 1.583333</span></code></pre></div>
<p>Названия столбцов можно получить с помощью функции <code><a href="https://rdrr.io/r/base/colnames.html">colnames()</a></code></p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">## [1] "colors"   "lengths"  "stations" "dens"</span></code></pre></div>
<p>Чтобы присоединить строку, сначала можно создать фрейм данных из одной строки:</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">row</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">"Фиолетовая"</span>, <span class="fl">40.5</span>, <span class="fl">22</span>, <span class="fl">22</span><span class="op">/</span><span class="fl">45</span><span class="op">)</span></code></pre></div>
<p>Далее нужно убедиться, что столбцы в этом мини-фрейме называются также как и в том фрейме, куда мы хотим присоединить строку. Для этого нужно перезаписать результат, возвращаемый функцией <code><a href="https://rdrr.io/r/base/colnames.html">colnames()</a></code>:</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">row</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></code></pre></div>
<p>Обратите внимание на синтаксис вышеприведенного выражения. Когда функция возвращает результат, она обнаруживает свойство самого объекта, и мы можем его перезаписать. После того как столбцы приведены в соответствие, можно присоединить новую строку:</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">df</span>,<span class="va">row</span><span class="op">)</span></code></pre></div>
<p>Чтобы <em>отсортировать</em> фрейм данных по значению определенного поля, необходимо узнать порядок элементов в этом поле с помощью функции <code><a href="https://rdrr.io/r/base/order.html">order()</a></code> и проиндексировать им первое измерение фрейма:</p>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">lengths</span><span class="op">)</span>, <span class="op">]</span>
<span class="co">##       colors lengths stations      dens</span>
<span class="co">## 4 Коричневая    19.0       12 0.6315789</span>
<span class="co">## 1    Красная    28.0       20 0.7142857</span>
<span class="co">## 5  Оранжевая    38.0       24 0.6315789</span>
<span class="co">## 2    Зеленая    40.0       21 0.5250000</span>
<span class="co">## 6 Фиолетовая    40.5       22 0.4888889</span>
<span class="co">## 3      Синяя    45.0       22 0.4888889</span></code></pre></div>
<p>Чтобы <em>отфильтровать</em> фрейм данных по значению определенного поля, необходимо передать условие в первое измерение фрейма:</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">lengths</span> <span class="op">&gt;</span> <span class="fl">40</span>, <span class="op">]</span>
<span class="co">##       colors lengths stations      dens</span>
<span class="co">## 3      Синяя    45.0       22 0.4888889</span>
<span class="co">## 6 Фиолетовая    40.5       22 0.4888889</span></code></pre></div>
<p>Поскольку названия столбцов хранятся как вектор из строк, мы можем их переделать:</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Цвет"</span>,<span class="st">"Длина"</span>,<span class="st">"Станции"</span>,<span class="st">"Плотность"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">## [1] "Цвет"      "Длина"     "Станции"   "Плотность"</span></code></pre></div>
<p>Обратимся по новому названию столбца:</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">$</span><span class="va">Длина</span>
<span class="co">## [1] 28.0 40.0 45.0 19.0 38.0 40.5</span></code></pre></div>
<p>К фреймам данных, так же как и к однородным структурам, можно применять функцию <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> для получения описательных статистик. При этом отчет формируется по каждому столбцу:</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">##      Цвет               Длина          Станции        Плотность     </span>
<span class="co">##  Length:6           Min.   :19.00   Min.   :12.00   Min.   :0.4889  </span>
<span class="co">##  Class :character   1st Qu.:30.50   1st Qu.:20.25   1st Qu.:0.4979  </span>
<span class="co">##  Mode  :character   Median :39.00   Median :21.50   Median :0.5783  </span>
<span class="co">##                     Mean   :35.08   Mean   :20.17   Mean   :0.5800  </span>
<span class="co">##                     3rd Qu.:40.38   3rd Qu.:22.00   3rd Qu.:0.6316  </span>
<span class="co">##                     Max.   :45.00   Max.   :24.00   Max.   :0.7143</span></code></pre></div>
</div>
<div id="lists" class="section level3" number="2.2.2">
<h3>
<span class="header-section-number">2.2.2</span> Списки<a class="anchor" aria-label="anchor" href="#lists"><i class="fas fa-link"></i></a>
</h3>
<p>Список — это наиболее общий тип контейнера в R. Список отличается от вектора тем, что он может содержать набор объектов произвольного типа. В качестве элементов списка могут быть числа, строки, вектора, матрицы, фреймы данных — и все это в одном контейнере. Списки используются чтобы комбинировать разрозненную информацию. Результатом выполнения многих функций является список.</p>
<p>Например, можно создать список из текстового описания фрейма данных, самого фрейма данных и обобщающей статистики по нему:</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">=</span> <span class="st">"Этот фрейм данных содержит данные по 6 линиям Московского метро"</span>
<span class="va">s</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>  <span class="co"># summary() выдает обобщающую статистику вектору, матрице или фрейму данных</span></code></pre></div>
<p>Сооружаем список из трех элементов:</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metrolist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">df</span>, <span class="va">s</span><span class="op">)</span>
<span class="va">metrolist</span>
<span class="co">## [[1]]</span>
<span class="co">## [1] "Этот фрейм данных содержит данные по 6 линиям Московского метро"</span>
<span class="co">## </span>
<span class="co">## [[2]]</span>
<span class="co">##         Цвет Длина Станции Плотность</span>
<span class="co">## 1    Красная  28.0      20 0.7142857</span>
<span class="co">## 2    Зеленая  40.0      21 0.5250000</span>
<span class="co">## 3      Синяя  45.0      22 0.4888889</span>
<span class="co">## 4 Коричневая  19.0      12 0.6315789</span>
<span class="co">## 5  Оранжевая  38.0      24 0.6315789</span>
<span class="co">## 6 Фиолетовая  40.5      22 0.4888889</span>
<span class="co">## </span>
<span class="co">## [[3]]</span>
<span class="co">##      Цвет               Длина          Станции        Плотность     </span>
<span class="co">##  Length:6           Min.   :19.00   Min.   :12.00   Min.   :0.4889  </span>
<span class="co">##  Class :character   1st Qu.:30.50   1st Qu.:20.25   1st Qu.:0.4979  </span>
<span class="co">##  Mode  :character   Median :39.00   Median :21.50   Median :0.5783  </span>
<span class="co">##                     Mean   :35.08   Mean   :20.17   Mean   :0.5800  </span>
<span class="co">##                     3rd Qu.:40.38   3rd Qu.:22.00   3rd Qu.:0.6316  </span>
<span class="co">##                     Max.   :45.00   Max.   :24.00   Max.   :0.7143</span></code></pre></div>
<p>Можно дать элементам списка осмысленные названия при создании:</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metrolist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>desc <span class="op">=</span> <span class="va">d</span>, table <span class="op">=</span> <span class="va">df</span>, summary <span class="op">=</span> <span class="va">s</span><span class="op">)</span>
<span class="va">metrolist</span>
<span class="co">## $desc</span>
<span class="co">## [1] "Этот фрейм данных содержит данные по 6 линиям Московского метро"</span>
<span class="co">## </span>
<span class="co">## $table</span>
<span class="co">##         Цвет Длина Станции Плотность</span>
<span class="co">## 1    Красная  28.0      20 0.7142857</span>
<span class="co">## 2    Зеленая  40.0      21 0.5250000</span>
<span class="co">## 3      Синяя  45.0      22 0.4888889</span>
<span class="co">## 4 Коричневая  19.0      12 0.6315789</span>
<span class="co">## 5  Оранжевая  38.0      24 0.6315789</span>
<span class="co">## 6 Фиолетовая  40.5      22 0.4888889</span>
<span class="co">## </span>
<span class="co">## $summary</span>
<span class="co">##      Цвет               Длина          Станции        Плотность     </span>
<span class="co">##  Length:6           Min.   :19.00   Min.   :12.00   Min.   :0.4889  </span>
<span class="co">##  Class :character   1st Qu.:30.50   1st Qu.:20.25   1st Qu.:0.4979  </span>
<span class="co">##  Mode  :character   Median :39.00   Median :21.50   Median :0.5783  </span>
<span class="co">##                     Mean   :35.08   Mean   :20.17   Mean   :0.5800  </span>
<span class="co">##                     3rd Qu.:40.38   3rd Qu.:22.00   3rd Qu.:0.6316  </span>
<span class="co">##                     Max.   :45.00   Max.   :24.00   Max.   :0.7143</span></code></pre></div>
<p>Теперь можно обратиться к элементу списка по его названию:</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metrolist</span><span class="op">$</span><span class="va">summary</span>
<span class="co">##      Цвет               Длина          Станции        Плотность     </span>
<span class="co">##  Length:6           Min.   :19.00   Min.   :12.00   Min.   :0.4889  </span>
<span class="co">##  Class :character   1st Qu.:30.50   1st Qu.:20.25   1st Qu.:0.4979  </span>
<span class="co">##  Mode  :character   Median :39.00   Median :21.50   Median :0.5783  </span>
<span class="co">##                     Mean   :35.08   Mean   :20.17   Mean   :0.5800  </span>
<span class="co">##                     3rd Qu.:40.38   3rd Qu.:22.00   3rd Qu.:0.6316  </span>
<span class="co">##                     Max.   :45.00   Max.   :24.00   Max.   :0.7143</span></code></pre></div>
<p>Поскольку <code>summary</code> сама является фреймом данных, из нее можно извлечь столбец:</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metrolist</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>
<span class="co">##                                                                         </span>
<span class="co">## "Min.   :12.00  " "1st Qu.:20.25  " "Median :21.50  " "Mean   :20.17  " </span>
<span class="co">##                                     </span>
<span class="co">## "3rd Qu.:22.00  " "Max.   :24.00  "</span></code></pre></div>
<p>К элементу списка можно также обратиться по его порядковому номеру или названию, заключив их в <em>двойные</em> квадратные скобки:</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">metrolist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="co">## [1] "Этот фрейм данных содержит данные по 6 линиям Московского метро"</span>
<span class="va">metrolist</span><span class="op">[[</span><span class="st">"desc"</span><span class="op">]</span><span class="op">]</span>
<span class="co">## [1] "Этот фрейм данных содержит данные по 6 линиям Московского метро"</span></code></pre></div>
<p>Использование <em>двойных скобок</em> отличает списки от векторов.</p>
<p>Вызов функции <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> в приложении к списку выведет статистику по типам и количеству элементов списка:</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">metrolist</span><span class="op">)</span>
<span class="co">##         Length Class      Mode     </span>
<span class="co">## desc     1     -none-     character</span>
<span class="co">## table    4     data.frame list     </span>
<span class="co">## summary 24     table      character</span></code></pre></div>
</div>
</div>
<div id="factors" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> Факторы<a class="anchor" aria-label="anchor" href="#factors"><i class="fas fa-link"></i></a>
</h2>
<p>Понятие <em>фактора</em> в терминологии <strong>R</strong> используется для обозначения категориальной (качественной) переменной. Как известно, такие переменные могут быть номинальными (с неопределенным порядком) и порядковыми (с заданным отношением порядка). Проблема взаимодействия с категориальными переменными заключается в том, что они могут приобретать разнообразные формы: быть выражены в виде чисел и строк. Эта форма может быть обманчивой. Например, модели самолетов Boeing и Sukhoi SuperJet обознаются числами (747, 100 и т.д.). Однако очевидно, что складывать и вычитать такие числа смысла нет, они являются формой представления номинальной переменной. Другой пример: названия месяцев записываются в виде строк. Если попытаться отсортировать месяцы цветения различных видов деревьев, то получится бессмысленный алфавитный порядок, в котором апрель следует за августом. В данном случае проблема заключается в том, что мы имеем дело с категориальной переменной, в которой задан порядок следования допустимых значений.</p>
<p>В географических данных категориальные переменные тоже достаточно распространены. К номинальной шкале измерений относятся всевозможные числовые коды: почтовые, ОКАТО и т.д. К порядковой шкале - административный статус населенного пункта, сила землетрясения по шкале Рихтера. Для того, чтобы соответствующие данные в среде <strong>R</strong> правильно обрабатывались статистическими функциями и отображались в виде подходящих графических способов, необходимо явным образом проинформировать об этом программу. Для этого и создаются факторы.</p>
<p>Фактор построен по принципу <a href="https://ru.wikipedia.org/wiki/%D0%90%D1%81%D1%81%D0%BE%D1%86%D0%B8%D0%B0%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%B9_%D0%BC%D0%B0%D1%81%D1%81%D0%B8%D0%B2">ассоциативного массива</a> и является надстройкой над вектором, в которой каждому значению вектора присваивается некий код. Вы можете управлять этими кодами, а можете оставить их на усмотрение программы.</p>
<p>Например, каждая линия Московского метро имеет свой номер. Создадим небольшей фрейм данных с электродепо по интересующим нас веткам метро и рассчитаем по ним описательные статистики:</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depots</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  depot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Северное'</span>, <span class="st">'Черкизово'</span>, <span class="st">'Сокол'</span>, <span class="st">'Замоскворецкое'</span>, 
            <span class="st">'Братеево'</span>, <span class="st">'Измайлово'</span>, <span class="st">'Фили'</span>, <span class="st">'Митино'</span>, 
            <span class="st">'Красная Пресня'</span>, <span class="st">'Калужское'</span>, <span class="st">'Свиблово'</span><span class="op">)</span>,
  year_opened <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1935</span>, <span class="fl">1990</span>, <span class="fl">1938</span>, <span class="fl">1969</span>, 
                  <span class="fl">2014</span>, <span class="fl">1950</span>, <span class="fl">1962</span>, <span class="fl">2016</span>,
                  <span class="fl">1954</span>, <span class="fl">1962</span>, <span class="fl">1978</span><span class="op">)</span>,
  line_number <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">6</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">depots</span><span class="op">)</span>
<span class="co">##             depot year_opened line_number</span>
<span class="co">## 1        Северное        1935           1</span>
<span class="co">## 2       Черкизово        1990           1</span>
<span class="co">## 3           Сокол        1938           2</span>
<span class="co">## 4  Замоскворецкое        1969           2</span>
<span class="co">## 5        Братеево        2014           2</span>
<span class="co">## 6       Измайлово        1950           3</span>
<span class="co">## 7            Фили        1962           3</span>
<span class="co">## 8          Митино        2016           3</span>
<span class="co">## 9  Красная Пресня        1954           5</span>
<span class="co">## 10      Калужское        1962           6</span>
<span class="co">## 11       Свиблово        1978           6</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">depots</span><span class="op">)</span>
<span class="co">##     depot            year_opened    line_number   </span>
<span class="co">##  Length:11          Min.   :1935   Min.   :1.000  </span>
<span class="co">##  Class :character   1st Qu.:1952   1st Qu.:2.000  </span>
<span class="co">##  Mode  :character   Median :1962   Median :3.000  </span>
<span class="co">##                     Mean   :1970   Mean   :3.091  </span>
<span class="co">##                     3rd Qu.:1984   3rd Qu.:4.000  </span>
<span class="co">##                     Max.   :2016   Max.   :6.000</span></code></pre></div>
<p>Как видно, <strong>R</strong> посчитал нам средний номер линии метро - 3.091, что выглядит, мягко говоря, странновато. Чтобы этого не происходило, укажем в явном виде с помощью функции <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code>, что номер линии метров является номинальной переменной:</p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">depots</span><span class="op">$</span><span class="va">line_number</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">depots</span><span class="op">$</span><span class="va">line_number</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">depots</span><span class="op">$</span><span class="va">line_number</span><span class="op">)</span>
<span class="co">##  [1] 1 1 2 2 2 3 3 3 5 6 6</span>
<span class="co">## Levels: 1 2 3 5 6</span></code></pre></div>
<p>Мы видим, что у переменной появился дополнительный атрибут <code>Levels</code>, который отвечает за список уникальных значений номинальной переменной. Отношение порядка мы здесь не вводим, поскольку номер является условным обозначением.</p>
<p>Попробуем теперь посчитать описательные статистики по переменной и таблице в целом:</p>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">depots</span><span class="op">$</span><span class="va">line_number</span><span class="op">)</span>
<span class="co">## [1] NA</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">depots</span><span class="op">)</span>
<span class="co">##     depot            year_opened   line_number</span>
<span class="co">##  Length:11          Min.   :1935   1:2        </span>
<span class="co">##  Class :character   1st Qu.:1952   2:3        </span>
<span class="co">##  Mode  :character   Median :1962   3:3        </span>
<span class="co">##                     Mean   :1970   5:1        </span>
<span class="co">##                     3rd Qu.:1984   6:2        </span>
<span class="co">##                     Max.   :2016</span></code></pre></div>
<p>Теперь мы видим, что вместо стандартных статистик <strong>R</strong> для переменной <em>line_number</em> выдает таблицу частот, из которой ясно, что на первой линии два депо, на второй линии три депо и так далее.</p>
</div>
<div id="vector_desc" class="section level2" number="2.4">
<h2>
<span class="header-section-number">2.4</span> Описание структуры данных<a class="anchor" aria-label="anchor" href="#vector_desc"><i class="fas fa-link"></i></a>
</h2>
<p>Для описания структуры данных можно использовать две широко используемые диагностические функции: <code><a href="https://rdrr.io/r/base/class.html">class()</a></code> выведет тип структуры, а <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code> выведет детальную выписку по компонентам этой структуры:</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">depots</span><span class="op">)</span> <span class="co"># тип объекта</span>
<span class="co">## [1] "data.frame"</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">depots</span><span class="op">)</span> <span class="co"># структура объекта</span>
<span class="co">## 'data.frame':    11 obs. of  3 variables:</span>
<span class="co">##  $ depot      : chr  "Северное" "Черкизово" "Сокол" "Замоскворецкое" ...</span>
<span class="co">##  $ year_opened: num  1935 1990 1938 1969 2014 ...</span>
<span class="co">##  $ line_number: Factor w/ 5 levels "1","2","3","5",..: 1 1 2 2 2 3 3 3 4 5 ...</span></code></pre></div>
</div>
<div id="cycles" class="section level2" number="2.5">
<h2>
<span class="header-section-number">2.5</span> Циклы<a class="anchor" aria-label="anchor" href="#cycles"><i class="fas fa-link"></i></a>
</h2>
<p>Цикл — это разновидность управляющей конструкции, предназначенная для организации многократного исполнения набора инструкций. В <strong>R</strong> циклы наиболее часто используются для пакетной обработки данных, ввода и вывода. Типичными примерами использования циклов являются чтение множества файлов входных данных, а также построение серий графиков и карт одного типа по различным данным. При этом обработка множества строк таблиц в R обычно организуется не средствами циклов, а средствами функций семейства <a href="http://stat.ethz.ch/R-manual/R-devel/library/base/html/lapply.html"><code>lapply</code></a>, о которых мы поговорим в главе, посвященной <a href="#techniques">техникам программирования</a> на R.</p>
<p>Циклы обычно связаны с проходом по элементам списка/вектора либо с созданием такого списка/вектора. Поэтому они излагаются в настоящей главе.</p>
<p>В R, как и во многих других языках программирования, существует несколько вариантов циклов. Первый вид циклов — это конструкция <strong>for</strong> с синтаксисом <code>for (x in X) statement</code>. Она означает, что:</p>
<ul>
<li>переменная <code>x</code> должна пробежать по всем элементам последовательности <code>X</code>. В качестве последовательности может выступать любой вектор или список.</li>
<li>каждый раз, когда <code>x</code> будет присвоено значение очередного элемента из <code>X</code>, будет выполнено выражение <code>statement</code>, которое называют <em>телом цикла</em>. Соответственно, цикл выполнится столько раз, сколько элементов содержится в последовательности <code>X</code>.</li>
</ul>
<blockquote>
<p>Выполнение тела цикла на каждом проходе называют <em>итерацией</em>.</p>
</blockquote>
<p>Например, с помощью цикла можно вывести на экран числа от 1 до 10, по одному с каждой строки:</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## ЦИКЛЫ</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
<span class="co">## [1] 1</span>
<span class="co">## [1] 2</span>
<span class="co">## [1] 3</span>
<span class="co">## [1] 4</span>
<span class="co">## [1] 5</span>
<span class="co">## [1] 6</span>
<span class="co">## [1] 7</span>
<span class="co">## [1] 8</span>
<span class="co">## [1] 9</span>
<span class="co">## [1] 10</span></code></pre></div>
<p>Если тело цикла содержит более одной инструкции R, оно должно быть заключено в фигурные скобки, иначе выполнится только первое выражение, а оставшиеся будут запущены один раз после выхода из цикла:</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">a</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Special.html">factorial</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="co"># факториал i</span>
  <span class="va">b</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="co"># e в степени i</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">a</span><span class="op">/</span><span class="va">b</span><span class="op">)</span> <span class="co"># факториал растет быстрее экспоненты</span>
<span class="op">}</span>
<span class="co">## [1] 0.3678794</span>
<span class="co">## [1] 0.2706706</span>
<span class="co">## [1] 0.2987224</span>
<span class="co">## [1] 0.4395753</span>
<span class="co">## [1] 0.8085536</span>
<span class="co">## [1] 1.784702</span>
<span class="co">## [1] 4.595885</span>
<span class="co">## [1] 13.52585</span>
<span class="co">## [1] 44.78295</span>
<span class="co">## [1] 164.7473</span></code></pre></div>
<p>Другой вариант цикла организуется с помощью конструкции <code>while</code>, имеющей синтаксис <code>while (condition) statement</code>. Такая конструкция означает, что тело цикла будет выполняться, пока значение выражения <code>condition</code> (условия) равно <code>TRUE</code>. Как правило, в теле цикла обновляется некоторая переменная, которая участвует в проверке условия, и предполагается, что рано или поздно оно станет равным <code>FALSE</code>, что приведет к выходу из цикла. Например, вышеприведенный цикл, печатающий числа от 1 до 10, можно переписать на <code>while</code> следуюшим образом:</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">i</span> <span class="op">=</span> <span class="fl">0</span>
<span class="kw">while</span><span class="op">(</span><span class="va">i</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">i</span> <span class="op">=</span> <span class="va">i</span><span class="op">+</span><span class="fl">1</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">## [1] 1</span>
<span class="co">## [1] 2</span>
<span class="co">## [1] 3</span>
<span class="co">## [1] 4</span>
<span class="co">## [1] 5</span>
<span class="co">## [1] 6</span>
<span class="co">## [1] 7</span>
<span class="co">## [1] 8</span>
<span class="co">## [1] 9</span>
<span class="co">## [1] 10</span></code></pre></div>
<p>Обратите внимание на то, что мы внутри цикла обновляем значение переменной i.</p>
<blockquote>
<p>Увеличение значения переменной цикла называется <em>инкрементом</em>, а уменьшение — <em>декрементом</em>.</p>
</blockquote>
<p>Одной из самых распространенных ошибок программистов (особенно начинающих, но и професионалы ее не избегают) является забытая инструкция инкремента (или декремента) переменной цикла, в результате чего цикл становится бесконечным. В этом плане конструкция <code>for</code> более надежна.</p>
<p>В качестве примера приведем проход по столбцам фрейма данных и вычисление медианного значения для каждого столбца таблицы линий метро:</p>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="va">medians</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span><span class="st">'numeric'</span>, <span class="va">n</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">medians</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="va">medians</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="co"># Переменные</span>
<span class="co">## [1] "Цвет"      "Длина"     "Станции"   "Плотность"</span>
<span class="va">medians</span> <span class="co"># Медианные значения</span>
<span class="co">## [1]         NA 39.0000000 21.5000000  0.5782895</span></code></pre></div>
<p>Существуют специальные операторы, позволяющие принудительно прервать текущую итерацию цикла и перейти на следующую, а также выйти из цикла вообще. Они называются <code>next</code> и <code>break</code>. Они бывают полезны, когда в теле цикла может произойти событие, делающее невозможным (или бессмысленным) его дальнейшее выполнение. Например, мы можем выводить информацию об электродепо, имеющихся на линии метро с введенным пользователем номером, до тех пор, пока он не введет символ <code>q</code>. Чтобы цикл был бесконечным, используем специальную форму <code>while (TRUE)</code>:</p>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">while</span> <span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">'Введите номер ветки метро:'</span><span class="op">)</span>
  <span class="va">input</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readline.html">readline</a></span><span class="op">(</span><span class="op">)</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">input</span> <span class="op">==</span> <span class="st">'q'</span><span class="op">)</span>
    <span class="kw">break</span>
  <span class="kw">else</span> <span class="op">{</span>
    <span class="va">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span>
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span>
      <span class="va">depots</span><span class="op">[</span><span class="va">depots</span><span class="op">$</span><span class="va">line_number</span> <span class="op">==</span> <span class="va">n</span>, <span class="op">]</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>Оператор <code>next</code> используется реже, так как в принципе он взаимозаменяем с конструкцией <code>if-else</code>. Он бывет удобен, когда в длинном цикле имеется несколько мест, в которых возможен переход на следующую итерацию. При использовании <code>next</code> последующий код нет необходимости табулировать и забирать в скобки. Следующие паттерны идентичны, но вариант с <code>next</code> позволяет остаться на том же уровне вложенности:</p>
<p>Паттерн 1:</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">while</span> <span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">condition1</span><span class="op">)</span>
    <span class="kw">next</span>
  <span class="va">...</span> <span class="co"># сюда попадем, только если condition1 == FALSE</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="va">condition2</span><span class="op">)</span>
    <span class="kw">next</span>
  <span class="va">...</span> <span class="co"># сюда попадем, только если condition2 == FALSE</span>
<span class="op">}</span></code></pre></div>
<p>Паттерн 2:</p>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">while</span> <span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">condition1</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">...</span> <span class="co"># сюда попадем, только если condition1 == FALSE</span>
    
    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">condition2</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">...</span> <span class="co"># сюда попадем, только если condition2 == FALSE</span>
    <span class="op">}</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="structures-detail" class="section level2" number="2.6">
<h2>
<span class="header-section-number">2.6</span> Технические детали<a class="anchor" aria-label="anchor" href="#structures-detail"><i class="fas fa-link"></i></a>
</h2>
<p>Внутреннюю структуру и размер объекта можно исследовать с помощью пакета <a href="https://lobstr.r-lib.org/">lobstr</a>. Например, посмотрим, как организован в пямяти объект <code>metrolist</code>:</p>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/lobstr">lobstr</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/lobstr/man/ref.html">ref</a></span><span class="op">(</span><span class="va">metrolist</span><span class="op">)</span>
<span class="co">## █ [1:0x7fc10ee90248] &lt;named list&gt; </span>
<span class="co">## ├─desc = [2:0x7fc12f62eb18] &lt;chr&gt; </span>
<span class="co">## ├─table = █ [3:0x7fc11f725cc8] &lt;df[,4]&gt; </span>
<span class="co">## │         ├─Цвет = [4:0x7fc16f4fcca8] &lt;chr&gt; </span>
<span class="co">## │         ├─Длина = [5:0x7fc16f4fcbc8] &lt;dbl&gt; </span>
<span class="co">## │         ├─Станции = [6:0x7fc16f4fcb58] &lt;dbl&gt; </span>
<span class="co">## │         └─Плотность = [7:0x7fc16f4fca08] &lt;dbl&gt; </span>
<span class="co">## └─summary = [8:0x7fc12e6a8e20] &lt;table[,4]&gt;</span>
<span class="fu"><a href="https://rdrr.io/pkg/lobstr/man/obj_size.html">obj_size</a></span><span class="op">(</span><span class="va">metrolist</span><span class="op">)</span>
<span class="co">## 5,136 B</span></code></pre></div>
</div>
<div id="review_structures" class="section level2" number="2.7">
<h2>
<span class="header-section-number">2.7</span> Краткий обзор<a class="anchor" aria-label="anchor" href="#review_structures"><i class="fas fa-link"></i></a>
</h2>
<p>Для просмотра презентации щелкните на ней один раз левой кнопкой мыши и листайте, используя кнопки на клавиатуре:
<iframe src="https://tsamsonov.github.io/r-geo-course-slides/02-DataStructures.html#1" width="100%" height="390px" data-external="1"></iframe></p>
<blockquote>
<p>Презентацию можно открыть в отдельном окне или вкладке браузере. Для этого щелкните по ней правой кнопкой мыши и выберите соответствующую команду.</p>
</blockquote>
</div>
<div id="questions_tasks_vectors" class="section level2" number="2.8">
<h2>
<span class="header-section-number">2.8</span> Контрольные вопросы и упражнения<a class="anchor" aria-label="anchor" href="#questions_tasks_vectors"><i class="fas fa-link"></i></a>
</h2>
<div id="questions_vectors" class="section level3" number="2.8.1">
<h3>
<span class="header-section-number">2.8.1</span> Вопросы<a class="anchor" aria-label="anchor" href="#questions_vectors"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>На какие две большие группы можно разделить структуры данных в R? Чем он отличаются?</li>
<li>Что такое вектор в языке R?</li>
<li>Какие способы создания векторов существуют?</li>
<li>Можно ли хранить в векторе данные разных типов?</li>
<li>Как определить длину вектора?</li>
<li>Как извлечь из вектора элемент по его индексу?</li>
<li>Как извлечь из вектора множество элементов по их индексам?</li>
<li>Как извлечь из вектора последний элемент?</li>
<li>С помощью какой функции можно сгенерировать последовательность чисел или дат с заданным шагом?</li>
<li>Как сгенерировать последовательность целых чисел с шагом 1, не прибегая к функциям?</li>
<li>Можно ли применять к векторам арифметические операторы и математические функции? Что будет результатом их выполнения?</li>
<li>С помощью какой функции можно отсортировать вектор? Как изменить порядок сортировки на противоположный?</li>
<li>С помощью какой функции можно найти индекс элемента вектора по его значению? Что вернет функция, если этот элемент встречается в векторе несколько раз?</li>
<li>Как работает функция <code><a href="https://rdrr.io/r/base/ifelse.html">ifelse()</a></code> и для чего она используется?</li>
<li>Как работает функция <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> и для чего она используется?</li>
<li>Какая функция позволяет создать матрицу? По строкам или по столбцам заполняется матрица при использовании вектора как источника данных по умолчанию?</li>
<li>Как извлечь элемент по его индексам из матрицы, массива, фрейма данных, списка?</li>
<li>Как извлечь строку или столбец из матрицы или фрейма данных?</li>
<li>С помощью какого специального символа можно обратиться к столбцу фрейма данных по его названию?</li>
<li>Как получить или записать названия столбцов фрейма данных?</li>
<li>Как получить или записать названия строк фрейма данных?</li>
<li>Какая структура данных является результатом сортировки матрицы?</li>
<li>Какая функция позволяет осуществить транспонирование матрицы?</li>
<li>Какой оператор используется для умножения матриц? Каким критериям должны отвечать перемножаемые матрицы, чтобы эта операция была осуществима?</li>
<li>Как добавить новый столбец в фрейм данных? Опишите несколько вариантов.</li>
<li>Как добавить новую строку в фрейм данных?</li>
<li>Что произойдет, если к целочисленной матрице прибавить столбец, заполненный строками?</li>
<li>Какая функция позволяет находить индексы элементов матрицы или фрейма данных по их значениям?</li>
<li>Что такое цикл и для каких сценариев обработки данных могут быть полезны циклы?</li>
<li>Перечислите несколько способов организации циклов в <strong>R</strong>, необходимые ключевые слова и параметры.</li>
<li>Что такое инкремент и декремент?</li>
<li>Какое ключевое слово позволяет прервать цикл и выйти из него принудительно?</li>
<li>Какое ключевое слово позволяет прекратить текущую итерацию цикла и перейти сразу к новой итерации?</li>
<li>Являются ли необходимыми фигурные скобки в случае когда цикл или условный оператор содержит только одно выражение? Что говорит об этом стиль программирования на <strong>R</strong>?</li>
</ol>
</div>
<div id="tasks_vectors" class="section level3" number="2.8.2">
<h3>
<span class="header-section-number">2.8.2</span> Упражнения<a class="anchor" aria-label="anchor" href="#tasks_vectors"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>
<p>Создайте вектор <code>temp</code>, в котором хранятся значения среднемесячных температур воздуха в городе Санкт-Петербурге (данные можно взять <a href="https://ru.wikipedia.org/wiki/%D0%9A%D0%BB%D0%B8%D0%BC%D0%B0%D1%82_%D0%A1%D0%B0%D0%BD%D0%BA%D1%82-%D0%9F%D0%B5%D1%82%D0%B5%D1%80%D0%B1%D1%83%D1%80%D0%B3%D0%B0">здесь</a>). Напишите программный код, который вычисляет следующие вектора:</p>
<ul>
<li>
<em>количественное изменение</em> температуры от месяца к месяцу (в градусах)</li>
<li>
<em>качественное изменение</em> температуры от месяца к месяцу (<code>'потепление'</code> или <code>'похолодание'</code>);</li>
<li>номера <em>зимних</em> месяцев (со среднемесячной температурой ниже нуля);</li>
<li>описательные статистики среднемесячных температур (<em>summary</em>);</li>
</ul>
<p>Выведите исходные и вычисленные данные в консоль (с пояснением что они означают).</p>
<blockquote>
<p><strong>Подсказка</strong>: для вычисления разностей между элементами вектора используйте функцию <a href="https://www.rdocumentation.org/packages/base/versions/3.6.1/topics/diff"><code>diff()</code></a>.</p>
</blockquote>
</li>
<li>
<p>На местности задан прямоугольник с координатами левого нижнего (<code>x1</code>, <code>y1</code>) и правого верхнего (<code>x2</code>, <code>y2</code>) угла. Напишите программу, которая размещает внутри этого прямоугольника случайным образом <em>N</em> точек и представляет результат в виде матрицы координат <code>coords</code> с двумя столбцами и <em>N</em> строками. Вызовите в конце программы <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot(coords)</a></code>, чтобы посмотреть на результат. Координаты можно не вводить, а задать прямо в программе в виде переменных.</p>
<blockquote>
<p><strong>Подсказка</strong>: координаты случайно размещенных точек имеют равномерное распределение. Вам необходимо сначала сформировать случайные векторы координат <code>X</code> и <code>Y</code>, и после этого объединить их в матрицу.</p>
</blockquote>
</li>
<li>
<p>Высотная поясность на северном склоне Западного Кавказа, <a href="https://bigenc.ru/geography/text/1877178">согласно</a> Большой Российской энциклопедии устроена следующим образом:</p>
<ul>
<li>до 500 м — степь и лесостепь</li>
<li>до 800 м — низкогорные широколиственные леса (дуб, граб)</li>
<li>до 1300 м — среднегорные широколиственные леса (бук)</li>
<li>до 1600 м — смешанные леса (ель, пихта, бук)</li>
<li>до 2300 м — криволесия (береза, бук, клён)</li>
<li>до 2500 м — субальпийские и альпийские луга</li>
<li>до 3300 м — субнивальная зона (фрагментарная растительность)</li>
<li>выше (условно до 5000 м) — гляциально-нивальная зона</li>
</ul>
<p>Создайте фрейм данных, включающий три столбца: минимальная высота пояса (<code>Hmin</code>), максимальная высота пояса (<code>Hmax</code>) и название высотного пояса (<code>Zone</code>). Минимальную высоту надо вычислить на основе максимальной, приняв, что для нижнего пояса она условно равна <span class="math inline">\(400~м\)</span>.</p>
<p>Напишите программу, которая просит пользователя ввести высоту и возвращает высотный пояс, соответствующую введенной высоте (достаточно вывести строчку фрейма данных).</p>
<blockquote>
<p><strong>Подсказка</strong>: Организуйте обход строчек фрейма данных с помощью цикла от <span class="math inline">\(1\)</span> до <span class="math inline">\(N\)</span>, где <span class="math inline">\(N\)</span> — количество строк. Искомый пояс будет найден, как только введенное значение станет меньше чем <code>Hmax</code>. После этого можно вывести результат на экран. Если введенное значение больше максимума в столбце <code>Hmax</code> или меньше <span class="math inline">\(400\)</span>, программа должна выдавать ошибку.</p>
</blockquote>
</li>
<li><p>[<strong>advanced</strong>] Решите задачу №3, используя только операции над векторами и поиск элементов, и не используя циклы.</p></li>
<li>
<p>[<strong>advanced</strong>] Модифицируйте программу, написанную для решения задачи №2 таким образом, чтобы запретить точкам сближаться более чем на заданное расстояние <em>k</em> (это называется <em>регулярным распределением</em> с расстоянием ингибиции <em>k</em>). Сохраните результат в виде <em>фрейма данных</em> <code>points</code> со столбцами <em>X</em>, <em>Y</em> и <em>D</em>, где <em>D</em> – это расстояние до ближайшей точки. Выведите верхние строчки полученной таблицы в консоль, а также полученные точки с помощью команды <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot(coords$X, coords$Y)</a></code>.</p>
<blockquote>
<p><strong>Подсказка</strong>: вам придется генерировать в цикле по одной точке и проверять условие на каждой итерации до тех пор, пока вы не наберете требуемое количество точек. Задавайте значение <em>k</em> малым по отношению к размерам прямоугольника, чтобы избежать излишне долгого выполнения программы.</p>
</blockquote>
</li>
</ol>
<div class="inline-table"><table class="table table-sm"><tbody><tr class="odd">
<td>
<em>Самсонов Т.Е.</em> <strong>Визуализация и анализ географических данных на языке R.</strong> М.: Географический факультет МГУ, 2021. DOI: <a href="https://doi.org/10.5281/zenodo.901911">10.5281/zenodo.901911</a>
</td>
</tr></tbody></table></div>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="basics.html"><span class="header-section-number">1</span> Типы данных</a></div>
<div class="next"><a href="tables.html"><span class="header-section-number">3</span> Таблицы</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data-structures"><span class="header-section-number">2</span> Структуры данных</a></li>
<li>
<a class="nav-link" href="#data_structures_homo"><span class="header-section-number">2.1</span> Однородные структуры данных</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#vectors"><span class="header-section-number">2.1.1</span> Векторы</a></li>
<li><a class="nav-link" href="#matrices"><span class="header-section-number">2.1.2</span> Матрицы</a></li>
<li><a class="nav-link" href="#arrays"><span class="header-section-number">2.1.3</span> Массивы</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#heterogeneous"><span class="header-section-number">2.2</span> Разнородные структуры данных</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#data_frames"><span class="header-section-number">2.2.1</span> Фреймы данных</a></li>
<li><a class="nav-link" href="#lists"><span class="header-section-number">2.2.2</span> Списки</a></li>
</ul>
</li>
<li><a class="nav-link" href="#factors"><span class="header-section-number">2.3</span> Факторы</a></li>
<li><a class="nav-link" href="#vector_desc"><span class="header-section-number">2.4</span> Описание структуры данных</a></li>
<li><a class="nav-link" href="#cycles"><span class="header-section-number">2.5</span> Циклы</a></li>
<li><a class="nav-link" href="#structures-detail"><span class="header-section-number">2.6</span> Технические детали</a></li>
<li><a class="nav-link" href="#review_structures"><span class="header-section-number">2.7</span> Краткий обзор</a></li>
<li>
<a class="nav-link" href="#questions_tasks_vectors"><span class="header-section-number">2.8</span> Контрольные вопросы и упражнения</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#questions_vectors"><span class="header-section-number">2.8.1</span> Вопросы</a></li>
<li><a class="nav-link" href="#tasks_vectors"><span class="header-section-number">2.8.2</span> Упражнения</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/tsamsonov/r-geo-course/blob/master/02-DataStructures.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/tsamsonov/r-geo-course/edit/master/02-DataStructures.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Визуализация и анализ географических данных на языке R</strong>" was written by Тимофей Самсонов. It was last built on 2021-10-25.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
